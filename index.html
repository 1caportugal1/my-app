<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="manifest" href="manifest.json">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#ffffff">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elenia - Nutrition Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: linear-gradient(135deg, #009b3a 0%, #ffd700 100%);
            --bg-secondary: #ffffff;
            --bg-tertiary: #f8f9fa;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --border-color: #dee2e6;
            --card-bg: #ffffff;
            --input-bg: #ffffff;
        }

        [data-theme="dark"] {
            --bg-primary: linear-gradient(135deg, #006b28 0%, #ccaa00 100%);
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #2d2d2d;
            --text-primary: #e9ecef;
            --text-secondary: #adb5bd;
            --border-color: #495057;
            --card-bg: #2d2d2d;
            --input-bg: #212529;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            padding: 20px;
            transition: background 0.3s ease;
        }

        [data-theme="dark"] body {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        }

        .container {
            max-width: 428px;
            margin: 0 auto;
            background: var(--bg-secondary);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            transition: background 0.3s ease;
        }

        .header {
            background: var(--bg-primary);
            color: white;
            padding: 30px 20px;
            text-align: center;
            position: relative;
            transition: background 0.3s ease;
        }

        .settings-icon {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }

        .settings-icon:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .settings-content {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-radius: 16px;
            padding: 24px;
            max-width: 400px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .settings-section {
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .settings-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .setting-item {
            margin-bottom: 16px;
        }

        .toggle-label {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            font-size: 14px;
        }

        .toggle-label input[type="checkbox"] {
            display: none;
        }

        .toggle-slider {
            position: relative;
            width: 50px;
            height: 26px;
            background: var(--border-color);
            border-radius: 13px;
            transition: background 0.3s;
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: white;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
        }

        .toggle-label input[type="checkbox"]:checked + .toggle-slider {
            background: #009b3a;
        }

        .toggle-label input[type="checkbox"]:checked + .toggle-slider::before {
            transform: translateX(24px);
        }

        .settings-btn {
            padding: 10px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .settings-btn:hover {
            background: var(--bg-primary);
            color: white;
            border-color: transparent;
        }

        .settings-btn.danger {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
            border-color: rgba(220, 53, 69, 0.3);
        }

        .settings-btn.danger:hover {
            background: #dc3545;
            color: white;
        }

        .footer-message {
            text-align: center;
            padding: 20px;
            font-size: 14px;
            color: var(--text-secondary);
            font-style: italic;
            background: var(--bg-tertiary);
            border-radius: 0 0 24px 24px;
            margin-top: -1px;
        }

        [data-theme="dark"] .footer-message {
            background: rgba(255, 255, 255, 0.05);
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .tabs-dock {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 16px 8px 12px 8px;
            border-bottom: 1px solid rgba(0, 155, 58, 0.2);
            gap: 8px;
            height: 100px;
        }

        .tab-dock {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            background: rgba(0, 155, 58, 0.05);
            border: 2px solid transparent;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            border-radius: 12px;
            min-width: 70px;
            transform-origin: bottom center;
            position: relative;
        }

        .tab-dock:hover {
            background: rgba(0, 155, 58, 0.1);
            border-color: rgba(0, 155, 58, 0.3);
            transform: translateY(-8px) scale(1.15);
            box-shadow: 0 8px 16px rgba(0, 155, 58, 0.2);
        }

        .tab-dock.active {
            background: linear-gradient(135deg, rgba(0, 155, 58, 0.15) 0%, rgba(255, 215, 0, 0.15) 100%);
            border-color: #009b3a;
            transform: translateY(-4px) scale(1.05);
        }

        .tab-dock.active:hover {
            transform: translateY(-10px) scale(1.2);
        }

        .tab-icon {
            font-size: 32px;
            margin-bottom: 4px;
            transition: font-size 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .tab-dock:hover .tab-icon {
            font-size: 42px;
        }

        .tab-dock.active .tab-icon {
            font-size: 36px;
        }

        .tab-dock.active:hover .tab-icon {
            font-size: 46px;
        }

        .tab-label {
            font-size: 11px;
            font-weight: 600;
            color: #495057;
            text-align: center;
            opacity: 0.7;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab-dock:hover .tab-label {
            opacity: 1;
            font-size: 12px;
            color: #009b3a;
        }

        .tab-dock.active .tab-label {
            color: #009b3a;
            opacity: 1;
        }

        .content {
            padding: 20px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .goals-section {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .goals-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 12px;
        }

        .goal-card {
            background: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .goal-card label {
            font-size: 12px;
            color: #6c757d;
            display: block;
            margin-bottom: 4px;
        }

        .goal-card input {
            width: 100%;
            padding: 8px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
            text-align: center;
        }

        .food-entry {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .food-entry h3 {
            font-size: 16px;
            margin-bottom: 12px;
            color: #495057;
        }

        .input-group {
            margin-bottom: 12px;
        }

        .input-group label {
            display: block;
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .input-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
        }

        .nutrients-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #009b3a 0%, #ffd700 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 155, 58, 0.4);
        }

        .food-list {
            margin-top: 20px;
        }

        .food-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #e9ecef;
        }

        .food-item-info h4 {
            font-size: 14px;
            margin-bottom: 4px;
        }

        .food-item-info p {
            font-size: 12px;
            color: #6c757d;
        }

        .food-item button {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #009b3a 0%, #ffd700 100%);
            color: white;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 24px;
            margin-bottom: 4px;
        }

        .stat-card p {
            font-size: 12px;
            opacity: 0.9;
        }

        .chart-container {
            background: white;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .chart-container h3 {
            font-size: 16px;
            margin-bottom: 12px;
            color: #495057;
        }

        .progress-bar {
            background: #e9ecef;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #009b3a 0%, #ffd700 100%);
            transition: width 0.3s;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }

        .empty-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .search-result-item {
            padding: 12px;
            border-bottom: 1px solid #e9ecef;
            cursor: pointer;
            transition: background 0.2s;
        }

        .search-result-item:hover {
            background: #f8f9fa;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
            position: relative;
        }

        .calendar-day:hover {
            border-color: #009b3a;
        }

        .calendar-day.today {
            border-color: #ffd700;
            background: #fffbf0;
        }

        .calendar-day.has-data {
            background: linear-gradient(135deg, rgba(0, 155, 58, 0.1) 0%, rgba(255, 215, 0, 0.1) 100%);
        }

        .calendar-day.selected {
            background: linear-gradient(135deg, #009b3a 0%, #ffd700 100%);
            color: white;
        }

        .calendar-day-number {
            font-size: 14px;
            font-weight: 600;
        }

        .calendar-day-calories {
            font-size: 10px;
            color: #6c757d;
            margin-top: 2px;
        }

        .calendar-day.selected .calendar-day-calories {
            color: white;
        }

        .calendar-day.other-month {
            opacity: 0.3;
            pointer-events: none;
        }

        .calendar-header {
            font-size: 11px;
            font-weight: 600;
            color: #6c757d;
            text-align: center;
            padding: 8px 0;
        }

        .meal-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 4px solid #009b3a;
        }

        .meal-item h4 {
            font-size: 14px;
            margin-bottom: 4px;
            color: #495057;
        }

        .meal-item p {
            font-size: 12px;
            color: #6c757d;
        }

        .view-btn {
            transition: all 0.2s;
        }

        .view-btn.active {
            background: linear-gradient(135deg, #009b3a 0%, #ffd700 100%) !important;
            color: white !important;
            border-color: transparent !important;
        }

        .day-view-container {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .week-day-column {
            background: white;
            border-radius: 8px;
            padding: 12px 8px;
            min-height: 100px;
        }

        .week-day-header {
            font-size: 11px;
            font-weight: 600;
            color: #6c757d;
            text-align: center;
            margin-bottom: 4px;
        }

        .week-day-date {
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 8px;
        }

        .week-day-column.today {
            background: linear-gradient(135deg, rgba(0, 155, 58, 0.1) 0%, rgba(255, 215, 0, 0.1) 100%);
            border: 2px solid #ffd700;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçÉ Elenia</h1>
            <p>Track your nutrition goals</p>
            <button onclick="toggleSettings()" class="settings-icon" title="Settings">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M12 1v6m0 6v6m0-18a2 2 0 0 1 2 2v.5a2 2 0 0 0 1 1.732l.5.289a2 2 0 0 0 2.732-1l.289-.5A2 2 0 0 1 21 7.268M12 1a2 2 0 0 0-2 2v.5a2 2 0 0 1-1 1.732l-.5.289a2 2 0 0 1-2.732-1l-.289-.5A2 2 0 0 0 3 7.268"/>
                </svg>
            </button>
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal" class="settings-modal" style="display: none;">
            <div class="settings-content">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="font-size: 20px; margin: 0;">‚öôÔ∏è Settings</h2>
                    <button onclick="toggleSettings()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: inherit;">√ó</button>
                </div>

                <div class="settings-section">
                    <h3 style="font-size: 16px; margin-bottom: 12px;">Appearance</h3>
                    <div class="setting-item">
                        <label class="toggle-label">
                            <span>Dark Mode</span>
                            <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 style="font-size: 16px; margin-bottom: 12px;">Units</h3>
                    <div class="setting-item">
                        <label style="display: block; font-size: 14px; margin-bottom: 4px;">Weight Unit</label>
                        <select id="weightUnit" onchange="saveSettings()" style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary);">
                            <option value="lbs">Pounds (lbs)</option>
                            <option value="kg">Kilograms (kg)</option>
                        </select>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 style="font-size: 16px; margin-bottom: 12px;">Data</h3>
                    <button onclick="exportData()" class="settings-btn" style="width: 100%; margin-bottom: 8px;">
                        üì• Export All Data
                    </button>
                    <button onclick="importData()" class="settings-btn" style="width: 100%; margin-bottom: 8px;">
                        üì§ Import Data
                    </button>
                    <button onclick="clearAllData()" class="settings-btn danger" style="width: 100%;">
                        üóëÔ∏è Clear All Data
                    </button>
                </div>

                <div class="settings-section">
                    <h3 style="font-size: 16px; margin-bottom: 12px;">About</h3>
                    <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 8px;">Elenia Nutrition Tracker</p>
                    <p style="font-size: 12px; color: var(--text-secondary);">Version 1.0</p>
                </div>
            </div>
        </div>

        <div class="tabs-dock">
            <button class="tab-dock" data-tab="plans" onclick="switchTab(event, 'plans')" onmousemove="magnifyTab(event)" onmouseleave="resetTab(event)">
                <div class="tab-icon">üìã</div>
                <div class="tab-label">Meal Plans</div>
            </button>
            <button class="tab-dock" data-tab="calendar" onclick="switchTab(event, 'calendar')" onmousemove="magnifyTab(event)" onmouseleave="resetTab(event)">
                <div class="tab-icon">üìÖ</div>
                <div class="tab-label">Calendar</div>
            </button>
            <button class="tab-dock active" data-tab="log" onclick="switchTab(event, 'log')" onmousemove="magnifyTab(event)" onmouseleave="resetTab(event)">
                <div class="tab-icon">üçΩÔ∏è</div>
                <div class="tab-label">Log Food</div>
            </button>
            <button class="tab-dock" data-tab="stats" onclick="switchTab(event, 'stats')" onmousemove="magnifyTab(event)" onmouseleave="resetTab(event)">
                <div class="tab-icon">üìä</div>
                <div class="tab-label">Statistics</div>
            </button>
            <button class="tab-dock" data-tab="goals" onclick="switchTab(event, 'goals')" onmousemove="magnifyTab(event)" onmouseleave="resetTab(event)">
                <div class="tab-icon">üéØ</div>
                <div class="tab-label">Goals</div>
            </button>
        </div>

        <div class="content">
            <!-- Log Food Tab -->
            <div id="log" class="tab-content active">
                <div class="food-entry">
                    <h3>üì∏ Snap Your Meal</h3>
                    <p style="font-size: 13px; color: #6c757d; margin-bottom: 12px;">Take a photo and AI will identify foods and estimate portions</p>
                    <input type="file" id="foodPhoto" accept="image/*" capture="environment" style="display: none;" onchange="analyzeFoodPhoto(event)">
                    <button onclick="document.getElementById('foodPhoto').click()" class="btn btn-primary" style="margin-bottom: 8px;">
                        üì∑ Take Photo / Upload Image
                    </button>
                    <div id="photoPreview" style="display: none; margin-top: 12px;">
                        <img id="previewImage" style="width: 100%; border-radius: 8px; margin-bottom: 12px;">
                        <div id="analysisLoading" style="display: none; text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 24px; margin-bottom: 8px;">üîç</div>
                            <p style="color: #6c757d;">Analyzing your food...</p>
                        </div>
                        <div id="analysisResults" style="display: none; background: #f8f9fa; padding: 12px; border-radius: 8px;">
                            <h4 style="font-size: 14px; margin-bottom: 8px;">Detected Foods:</h4>
                            <div id="detectedFoods"></div>
                            <button onclick="addDetectedFoods()" class="btn btn-primary" style="margin-top: 12px;">Add All to Meal</button>
                        </div>
                    </div>
                </div>

                <div class="food-entry">
                    <h3>üîç Search Food Database</h3>
                    <div class="input-group">
                        <label>Meal Name (optional)</label>
                        <input type="text" id="mealName" placeholder="e.g., Breakfast, Lunch, Post-Workout">
                    </div>
                    <div class="input-group">
                        <label>Search for food to add</label>
                        <input type="text" id="foodSearch" placeholder="e.g., chicken, rice, apple..." oninput="searchFood()">
                    </div>
                    <div id="searchResults" style="display: none; max-height: 200px; overflow-y: auto; background: white; border: 1px solid #dee2e6; border-radius: 8px; margin-top: 8px;">
                    </div>
                </div>

                <div id="portionEntry" style="display: none;" class="food-entry">
                    <h3 id="selectedFoodName">Selected Food</h3>
                    <div style="background: white; padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                        <p style="font-size: 12px; color: #6c757d; margin-bottom: 4px;">Per 100g/100ml:</p>
                        <p style="font-size: 14px;" id="nutritionInfo"></p>
                    </div>
                    <div class="input-group">
                        <label>Portion Size (grams/ml)</label>
                        <input type="number" id="portionSize" placeholder="100" value="100" oninput="updatePortionPreview()">
                    </div>
                    <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                        <p style="font-size: 12px; color: #6c757d; margin-bottom: 4px;">Your portion:</p>
                        <p style="font-size: 14px; font-weight: 600;" id="portionPreview"></p>
                    </div>
                    <button class="btn btn-primary" onclick="addToMeal()">Add to Meal</button>
                    <button class="btn" style="background: #6c757d; color: white; margin-top: 8px;" onclick="cancelSelection()">Cancel</button>
                </div>

                <!-- Current Meal Being Built -->
                <div id="mealBuilder" style="display: none;" class="food-entry">
                    <h3>Current Meal <span id="mealBuilderName" style="font-size: 14px; color: #6c757d;"></span></h3>
                    <div id="mealItems" style="margin-bottom: 12px;"></div>
                    <div style="background: linear-gradient(135deg, #009b3a 0%, #ffd700 100%); color: white; padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                        <p style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">Meal Total:</p>
                        <p style="font-size: 16px; font-weight: 600;" id="mealTotal"></p>
                    </div>
                    <button class="btn btn-primary" onclick="submitMeal()">Submit Meal to Log</button>
                    <button class="btn" style="background: #dc3545; color: white; margin-top: 8px;" onclick="clearMeal()">Clear Meal</button>
                </div>

                <div class="food-entry" id="manualEntry">
                    <h3>Or Add Single Food Manually</h3>
                    <div class="input-group">
                        <label>Food Name</label>
                        <input type="text" id="manualFoodName" placeholder="e.g., Custom Meal">
                    </div>
                    <div class="input-group">
                        <label>Calories</label>
                        <input type="number" id="manualCalories" placeholder="250">
                    </div>
                    <div class="nutrients-row">
                        <div class="input-group">
                            <label>Protein (g)</label>
                            <input type="number" id="manualProtein" placeholder="30">
                        </div>
                        <div class="input-group">
                            <label>Carbs (g)</label>
                            <input type="number" id="manualCarbs" placeholder="0">
                        </div>
                        <div class="input-group">
                            <label>Fats (g)</label>
                            <input type="number" id="manualFats" placeholder="5">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="addManualFood()">Add to Log</button>
                </div>

                <div style="margin-top: 20px;">
                    <h3 style="font-size: 16px; margin-bottom: 12px; color: #495057;">Today's Log</h3>
                    <div class="food-list" id="foodList">
                        <div class="empty-state">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                            </svg>
                            <p>No foods logged today. Add your first meal!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Meal Plans Tab -->
            <div id="plans" class="tab-content">
                <div style="background: linear-gradient(135deg, #009b3a 0%, #ffd700 100%); color: white; padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                    <h2 style="font-size: 18px; margin-bottom: 8px;">üóìÔ∏è Meal Planning</h2>
                    <p style="font-size: 13px; opacity: 0.9;">Create meal templates and schedule them for multiple days</p>
                </div>

                <!-- Saved Meal Templates -->
                <div style="background: #f8f9fa; padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h3 style="font-size: 16px;">üìã My Meal Templates</h3>
                        <button onclick="showCreateTemplate()" style="background: #009b3a; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; cursor: pointer; font-weight: 600;">+ New Template</button>
                    </div>
                    <div id="mealTemplatesList">
                        <p style="font-size: 13px; color: #6c757d; text-align: center; padding: 20px;">No meal templates yet. Create one to get started!</p>
                    </div>
                </div>

                <!-- Create/Edit Template -->
                <div id="templateBuilder" style="display: none; background: #f8f9fa; padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                    <h3 style="font-size: 16px; margin-bottom: 12px;">Create Meal Template</h3>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; font-size: 12px; color: #6c757d; margin-bottom: 4px; font-weight: 600;">Template Name</label>
                        <input type="text" id="templateName" placeholder="e.g., My Go-To Breakfast" style="width: 100%; padding: 10px; border: 1px solid #dee2e6; border-radius: 8px; font-size: 14px;">
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; font-size: 12px; color: #6c757d; margin-bottom: 4px; font-weight: 600;">Meal Type</label>
                        <select id="templateMealType" style="width: 100%; padding: 10px; border: 1px solid #dee2e6; border-radius: 8px; font-size: 14px; background: white;">
                            <option value="Breakfast">Breakfast</option>
                            <option value="Lunch">Lunch</option>
                            <option value="Dinner">Dinner</option>
                            <option value="Snack">Snack</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; font-size: 12px; color: #6c757d; margin-bottom: 8px; font-weight: 600;">Add Foods to Template</label>
                        <input type="text" id="templateFoodSearch" placeholder="Search foods..." oninput="searchFoodForTemplate()" style="width: 100%; padding: 10px; border: 1px solid #dee2e6; border-radius: 8px; font-size: 14px; margin-bottom: 8px;">
                        <div id="templateSearchResults" style="display: none; max-height: 150px; overflow-y: auto; background: white; border: 1px solid #dee2e6; border-radius: 8px; margin-bottom: 8px;"></div>
                        <div id="templateFoodsList" style="background: white; padding: 12px; border-radius: 8px; min-height: 60px;">
                            <p style="font-size: 12px; color: #6c757d; text-align: center;">No foods added yet</p>
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="saveTemplate()" class="btn btn-primary" style="flex: 1;">Save Template</button>
                        <button onclick="cancelTemplate()" class="btn" style="flex: 1; background: #6c757d; color: white;">Cancel</button>
                    </div>
                </div>

                <!-- Schedule Meals -->
                <div style="background: #f8f9fa; padding: 16px; border-radius: 12px;">
                    <h3 style="font-size: 16px; margin-bottom: 12px;">üìÖ Schedule Meals</h3>
                    <div id="scheduleInterface">
                        <p style="font-size: 13px; color: #6c757d; text-align: center; padding: 20px;">Create a meal template first, then schedule it for specific days</p>
                    </div>
                </div>
            </div>

            <!-- Calendar Tab -->
            <div id="calendar" class="tab-content">
                <div style="background: #f8f9fa; padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <button onclick="navigateTime(-1)" style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 18px;">‚Üê</button>
                        <div style="text-align: center; flex: 1;">
                            <h3 id="calendarMonth" style="font-size: 18px; margin: 0 0 8px 0;">Month Year</h3>
                            <div style="display: flex; gap: 4px; justify-content: center;">
                                <button onclick="setCalendarView('month')" id="viewMonth" class="view-btn active" style="padding: 6px 12px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; font-size: 12px; background: white; font-weight: 600;">Month</button>
                                <button onclick="setCalendarView('week')" id="viewWeek" class="view-btn" style="padding: 6px 12px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; font-size: 12px; background: white;">Week</button>
                                <button onclick="setCalendarView('day')" id="viewDay" class="view-btn" style="padding: 6px 12px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; font-size: 12px; background: white;">Day</button>
                            </div>
                        </div>
                        <button onclick="navigateTime(1)" style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 18px;">‚Üí</button>
                    </div>
                    <button onclick="goToToday()" style="width: 100%; padding: 8px; background: linear-gradient(135deg, #009b3a 0%, #ffd700 100%); color: white; border: none; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; margin-bottom: 12px;">Today</button>
                    <div id="calendarGrid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px;">
                        <!-- Calendar will be generated here -->
                    </div>
                </div>

                <div id="selectedDateView" style="display: none;">
                    <div style="background: linear-gradient(135deg, #009b3a 0%, #ffd700 100%); color: white; padding: 16px; border-radius: 12px; margin-bottom: 16px;">
                        <h3 id="selectedDateTitle" style="font-size: 18px; margin-bottom: 8px;">Date</h3>
                        <p id="selectedDateSummary" style="font-size: 14px; opacity: 0.9;"></p>
                    </div>

                    <div id="selectedDateFoods" style="background: #f8f9fa; padding: 16px; border-radius: 12px;">
                        <!-- Foods for selected date will appear here -->
                    </div>

                    <button onclick="closeSelectedDate()" class="btn" style="background: #6c757d; color: white; margin-top: 12px; width: 100%;">Close</button>
                </div>
            </div>

            <!-- Statistics Tab -->
            <div id="stats" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 id="totalCalories">0</h3>
                        <p>Total Calories</p>
                        <div class="progress-bar">
                            <div class="progress-fill" id="caloriesProgress"></div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalProtein">0g</h3>
                        <p>Protein</p>
                        <div class="progress-bar">
                            <div class="progress-fill" id="proteinProgress"></div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalCarbs">0g</h3>
                        <p>Carbs</p>
                        <div class="progress-bar">
                            <div class="progress-fill" id="carbsProgress"></div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalFats">0g</h3>
                        <p>Fats</p>
                        <div class="progress-bar">
                            <div class="progress-fill" id="fatsProgress"></div>
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <h3>Macronutrient Breakdown</h3>
                    <canvas id="pieChart"></canvas>
                </div>

                <div class="chart-container">
                    <h3>Daily Progress</h3>
                    <canvas id="barChart"></canvas>
                </div>

                <!-- Benchmarks & Comparisons -->
                <div style="background: #f8f9fa; padding: 16px; border-radius: 12px; margin-top: 20px;">
                    <h3 style="font-size: 18px; margin-bottom: 16px; color: #495057;">üìä How You Compare</h3>
                    
                    <div id="benchmarkComparison" style="background: white; padding: 14px; border-radius: 8px; margin-bottom: 16px;">
                        <h4 style="font-size: 14px; margin-bottom: 12px; color: #009b3a;">Your Profile vs. Average Person</h4>
                        <div id="benchmarkContent">
                            <p style="font-size: 13px; color: #6c757d; text-align: center; padding: 20px;">
                                Add your body stats in the Goals tab to see personalized comparisons
                            </p>
                        </div>
                    </div>

                    <button onclick="toggleDietExamples()" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #009b3a 0%, #ffd700 100%); color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; margin-bottom: 12px;">
                        üìã View Popular Diet Examples
                    </button>

                    <div id="dietExamples" style="display: none;">
                        <div style="background: white; padding: 14px; border-radius: 8px; margin-bottom: 12px;">
                            <h4 style="font-size: 14px; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                                üèãÔ∏è High Protein (Muscle Building)
                                <button onclick="applyDietTemplate('highprotein')" style="margin-left: auto; background: #009b3a; color: white; border: none; padding: 4px 12px; border-radius: 6px; font-size: 11px; cursor: pointer;">Apply</button>
                            </h4>
                            <p style="font-size: 12px; color: #6c757d; margin-bottom: 6px;">For athletes & muscle gain</p>
                            <p style="font-size: 13px;"><strong>Calories:</strong> 2500 | <strong>Protein:</strong> 200g (32%) | <strong>Carbs:</strong> 250g (40%) | <strong>Fats:</strong> 78g (28%)</p>
                        </div>

                        <div style="background: white; padding: 14px; border-radius: 8px; margin-bottom: 12px;">
                            <h4 style="font-size: 14px; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                                ‚öñÔ∏è Balanced (Maintenance)
                                <button onclick="applyDietTemplate('balanced')" style="margin-left: auto; background: #009b3a; color: white; border: none; padding: 4px 12px; border-radius: 6px; font-size: 11px; cursor: pointer;">Apply</button>
                            </h4>
                            <p style="font-size: 12px; color: #6c757d; margin-bottom: 6px;">Standard healthy eating</p>
                            <p style="font-size: 13px;"><strong>Calories:</strong> 2000 | <strong>Protein:</strong> 100g (20%) | <strong>Carbs:</strong> 250g (50%) | <strong>Fats:</strong> 67g (30%)</p>
                        </div>

                        <div style="background: white; padding: 14px; border-radius: 8px; margin-bottom: 12px;">
                            <h4 style="font-size: 14px; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                                üî• Low Carb (Keto-ish)
                                <button onclick="applyDietTemplate('lowcarb')" style="margin-left: auto; background: #009b3a; color: white; border: none; padding: 4px 12px; border-radius: 6px; font-size: 11px; cursor: pointer;">Apply</button>
                            </h4>
                            <p style="font-size: 12px; color: #6c757d; margin-bottom: 6px;">For fat loss & low carb diets</p>
                            <p style="font-size: 13px;"><strong>Calories:</strong> 1800 | <strong>Protein:</strong> 135g (30%) | <strong>Carbs:</strong> 90g (20%) | <strong>Fats:</strong> 100g (50%)</p>
                        </div>

                        <div style="background: white; padding: 14px; border-radius: 8px; margin-bottom: 12px;">
                            <h4 style="font-size: 14px; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                                ü•ó Moderate Deficit (Weight Loss)
                                <button onclick="applyDietTemplate('deficit')" style="margin-left: auto; background: #009b3a; color: white; border: none; padding: 4px 12px; border-radius: 6px; font-size: 11px; cursor: pointer;">Apply</button>
                            </h4>
                            <p style="font-size: 12px; color: #6c757d; margin-bottom: 6px;">Sustainable fat loss</p>
                            <p style="font-size: 13px;"><strong>Calories:</strong> 1600 | <strong>Protein:</strong> 140g (35%) | <strong>Carbs:</strong> 160g (40%) | <strong>Fats:</strong> 44g (25%)</p>
                        </div>

                        <div style="background: white; padding: 14px; border-radius: 8px; margin-bottom: 12px;">
                            <h4 style="font-size: 14px; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                                üí™ Lean Bulk (Clean Surplus)
                                <button onclick="applyDietTemplate('leanbulk')" style="margin-left: auto; background: #009b3a; color: white; border: none; padding: 4px 12px; border-radius: 6px; font-size: 11px; cursor: pointer;">Apply</button>
                            </h4>
                            <p style="font-size: 12px; color: #6c757d; margin-bottom: 6px;">Muscle gain with minimal fat</p>
                            <p style="font-size: 13px;"><strong>Calories:</strong> 2800 | <strong>Protein:</strong> 175g (25%) | <strong>Carbs:</strong> 350g (50%) | <strong>Fats:</strong> 78g (25%)</p>
                        </div>

                        <div style="background: white; padding: 14px; border-radius: 8px;">
                            <h4 style="font-size: 14px; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                                üèÉ Endurance Athlete
                                <button onclick="applyDietTemplate('endurance')" style="margin-left: auto; background: #009b3a; color: white; border: none; padding: 4px 12px; border-radius: 6px; font-size: 11px; cursor: pointer;">Apply</button>
                            </h4>
                            <p style="font-size: 12px; color: #6c757d; margin-bottom: 6px;">High carb for runners/cyclists</p>
                            <p style="font-size: 13px;"><strong>Calories:</strong> 3000 | <strong>Protein:</strong> 150g (20%) | <strong>Carbs:</strong> 450g (60%) | <strong>Fats:</strong> 67g (20%)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Goals Tab -->
            <div id="goals" class="tab-content">
                <div class="goals-section">
                    <h3 style="margin-bottom: 12px;">Body Stats</h3>
                    <div class="goals-grid">
                        <div class="goal-card">
                            <label>Current Weight (lbs)</label>
                            <input type="number" id="currentWeight" placeholder="150" onchange="saveBodyStats()">
                        </div>
                        <div class="goal-card">
                            <label>Height (inches)</label>
                            <input type="number" id="height" placeholder="68" onchange="saveBodyStats()">
                        </div>
                        <div class="goal-card">
                            <label>Goal Weight (lbs)</label>
                            <input type="number" id="goalWeight" placeholder="Optional" onchange="saveBodyStats()">
                        </div>
                        <div class="goal-card">
                            <label>Age</label>
                            <input type="number" id="age" placeholder="25" onchange="saveBodyStats()">
                        </div>
                    </div>
                    <div style="margin-top: 12px;">
                        <label style="font-size: 12px; color: #6c757d; margin-bottom: 4px; display: block; font-weight: 600;">Gender</label>
                        <select id="gender" onchange="saveBodyStats()" style="width: 100%; padding: 10px; border: 1px solid #dee2e6; border-radius: 8px; font-size: 14px; background: white;">
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                        </select>
                    </div>
                    <div style="margin-top: 12px;">
                        <label style="font-size: 12px; color: #6c757d; margin-bottom: 4px; display: block; font-weight: 600;">Activity Level</label>
                        <select id="activityLevel" onchange="saveBodyStats()" style="width: 100%; padding: 10px; border: 1px solid #dee2e6; border-radius: 8px; font-size: 14px; background: white;">
                            <option value="1.2">Sedentary (little/no exercise)</option>
                            <option value="1.375">Light (exercise 1-3 days/week)</option>
                            <option value="1.55" selected>Moderate (exercise 3-5 days/week)</option>
                            <option value="1.725">Active (exercise 6-7 days/week)</option>
                            <option value="1.9">Very Active (intense exercise daily)</option>
                        </select>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, #009b3a 0%, #ffd700 100%); padding: 16px; border-radius: 12px; margin-top: 20px; color: white;">
                    <h3 style="margin-bottom: 16px; font-size: 16px;">üìä Calorie Calculator</h3>
                    <div id="calculatorResults" style="display: none;">
                        <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                            <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">Your BMR (Base Metabolic Rate)</div>
                            <div style="font-size: 20px; font-weight: 600;" id="bmrValue">-</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                            <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">Maintenance Calories (TDEE)</div>
                            <div style="font-size: 20px; font-weight: 600;" id="tdeeValue">-</div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 8px;">
                                <div style="font-size: 11px; opacity: 0.9; margin-bottom: 4px;">Weight Loss<br>(Deficit)</div>
                                <div style="font-size: 16px; font-weight: 600;" id="deficitValue">-</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 8px;">
                                <div style="font-size: 11px; opacity: 0.9; margin-bottom: 4px;">Weight Gain<br>(Surplus)</div>
                                <div style="font-size: 16px; font-weight: 600;" id="surplusValue">-</div>
                            </div>
                        </div>
                        <div style="margin-top: 12px; display: flex; gap: 8px;">
                            <button onclick="applyCalories('deficit')" style="flex: 1; padding: 10px; background: rgba(255,255,255,0.9); border: none; border-radius: 8px; font-size: 13px; font-weight: 600; color: #009b3a; cursor: pointer;">Use Deficit</button>
                            <button onclick="applyCalories('maintenance')" style="flex: 1; padding: 10px; background: rgba(255,255,255,0.9); border: none; border-radius: 8px; font-size: 13px; font-weight: 600; color: #009b3a; cursor: pointer;">Use TDEE</button>
                            <button onclick="applyCalories('surplus')" style="flex: 1; padding: 10px; background: rgba(255,255,255,0.9); border: none; border-radius: 8px; font-size: 13px; font-weight: 600; color: #009b3a; cursor: pointer;">Use Surplus</button>
                        </div>
                    </div>
                    <div id="calculatorPrompt" style="text-align: center; padding: 20px 0; font-size: 14px; opacity: 0.9;">
                        Fill in your body stats above to calculate recommended calories
                    </div>
                    <button onclick="calculateCalories()" class="btn" style="background: white; color: #009b3a; width: 100%; margin-top: 8px;">Calculate</button>
                </div>

                <div class="goals-section" style="margin-top: 20px;">
                    <h3 style="margin-bottom: 12px;">Daily Goals</h3>
                    <div id="recommendedMacros" style="background: rgba(0, 155, 58, 0.1); padding: 12px; border-radius: 8px; margin-bottom: 12px; display: none;">
                        <div style="font-size: 12px; color: #009b3a; font-weight: 600; margin-bottom: 8px;">üí° Recommended Intake:</div>
                        <div style="font-size: 13px; color: #495057; line-height: 1.6;" id="macroRecommendations"></div>
                    </div>
                    <div class="goals-grid">
                        <div class="goal-card">
                            <label>Calories</label>
                            <input type="number" id="goalCalories" value="2000" onchange="saveGoals()">
                        </div>
                        <div class="goal-card">
                            <label>Protein (g)</label>
                            <input type="number" id="goalProtein" value="150" onchange="saveGoals()">
                        </div>
                        <div class="goal-card">
                            <label>Carbs (g)</label>
                            <input type="number" id="goalCarbs" value="200" onchange="saveGoals()">
                        </div>
                        <div class="goal-card">
                            <label>Fats (g)</label>
                            <input type="number" id="goalFats" value="65" onchange="saveGoals()">
                        </div>
                    </div>
                </div>

                <div style="background: #f8f9fa; padding: 16px; border-radius: 12px; margin-top: 20px;">
                    <h3 style="margin-bottom: 12px; font-size: 16px;">Goal Progress</h3>
                    <div style="margin-bottom: 12px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                            <span style="font-size: 14px; font-weight: 600;">Calories</span>
                            <span style="font-size: 14px;" id="caloriesGoalText">0 / 2000</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="caloriesGoalProgress"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                            <span style="font-size: 14px; font-weight: 600;">Protein</span>
                            <span style="font-size: 14px;" id="proteinGoalText">0g / 150g</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="proteinGoalProgress"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                            <span style="font-size: 14px; font-weight: 600;">Carbs</span>
                            <span style="font-size: 14px;" id="carbsGoalText">0g / 200g</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="carbsGoalProgress"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                            <span style="font-size: 14px; font-weight: 600;">Fats</span>
                            <span style="font-size: 14px;" id="fatsGoalText">0g / 65g</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="fatsGoalProgress"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer-message">
            I love you my elena - c
        </div>
    </div>

    <script>
        console.log('=== Elenia Starting ===');
        
        let foods = [];
        let pieChart = null;
        let barChart = null;
        let selectedFood = null;
        let currentMeal = [];
        let currentDate = new Date();
        let selectedDate = null;
        let viewingMonth = new Date();
        let calendarView = 'month'; // 'month', 'week', or 'day'
        let detectedFoodsFromPhoto = [];
        let mealTemplates = [];
        let currentTemplateBuilder = [];
        
        // Data structure: { "YYYY-MM-DD": [foods...] }
        let foodsByDate = {};

        // Food database - nutrition values per 100g
        const foodDatabase = [
            // Proteins
            { name: "Chicken Breast (raw)", calories: 165, protein: 31, carbs: 0, fats: 3.6, category: "Protein" },
            { name: "Chicken Breast (grilled)", calories: 165, protein: 31, carbs: 0, fats: 3.6, category: "Protein" },
            { name: "Chicken Thigh (raw)", calories: 209, protein: 26, carbs: 0, fats: 11, category: "Protein" },
            { name: "Chicken Wings", calories: 203, protein: 30, carbs: 0, fats: 8.1, category: "Protein" },
            { name: "Ground Beef (80/20)", calories: 254, protein: 17, carbs: 0, fats: 20, category: "Protein" },
            { name: "Ground Beef (90/10)", calories: 176, protein: 20, carbs: 0, fats: 10, category: "Protein" },
            { name: "Steak (Sirloin)", calories: 271, protein: 25, carbs: 0, fats: 18, category: "Protein" },
            { name: "Bacon", calories: 541, protein: 37, carbs: 1.4, fats: 42, category: "Protein" },
            { name: "Sausage (Pork)", calories: 301, protein: 12, carbs: 1.2, fats: 28, category: "Protein" },
            { name: "Salmon (raw)", calories: 208, protein: 20, carbs: 0, fats: 13, category: "Protein" },
            { name: "Tuna (canned in water)", calories: 116, protein: 26, carbs: 0, fats: 0.8, category: "Protein" },
            { name: "Tilapia", calories: 128, protein: 26, carbs: 0, fats: 2.7, category: "Protein" },
            { name: "Shrimp (raw)", calories: 85, protein: 20, carbs: 0, fats: 0.5, category: "Protein" },
            { name: "Eggs (whole)", calories: 143, protein: 13, carbs: 0.7, fats: 10, category: "Protein" },
            { name: "Egg Whites", calories: 52, protein: 11, carbs: 0.7, fats: 0.2, category: "Protein" },
            { name: "Greek Yogurt (plain, nonfat)", calories: 59, protein: 10, carbs: 3.6, fats: 0.4, category: "Protein" },
            { name: "Cottage Cheese (low-fat)", calories: 72, protein: 12, carbs: 4.3, fats: 1, category: "Protein" },
            { name: "Tofu (firm)", calories: 144, protein: 17, carbs: 3, fats: 9, category: "Protein" },
            { name: "Turkey Breast (raw)", calories: 135, protein: 30, carbs: 0, fats: 0.7, category: "Protein" },
            { name: "Pork Tenderloin (raw)", calories: 143, protein: 26, carbs: 0, fats: 3.5, category: "Protein" },
            { name: "Deli Turkey", calories: 104, protein: 19, carbs: 3.7, fats: 1.7, category: "Protein" },
            { name: "Deli Ham", calories: 145, protein: 21, carbs: 1.5, fats: 6, category: "Protein" },
            { name: "Protein Powder (whey)", calories: 400, protein: 80, carbs: 7, fats: 5, category: "Protein" },
            
            // Carbs
            { name: "White Rice (cooked)", calories: 130, protein: 2.7, carbs: 28, fats: 0.3, category: "Carbs" },
            { name: "Brown Rice (cooked)", calories: 112, protein: 2.6, carbs: 24, fats: 0.9, category: "Carbs" },
            { name: "Quinoa (cooked)", calories: 120, protein: 4.4, carbs: 21, fats: 1.9, category: "Carbs" },
            { name: "Oats (dry)", calories: 389, protein: 17, carbs: 66, fats: 6.9, category: "Carbs" },
            { name: "Whole Wheat Bread", calories: 247, protein: 13, carbs: 41, fats: 3.4, category: "Carbs" },
            { name: "White Bread", calories: 265, protein: 9, carbs: 49, fats: 3.2, category: "Carbs" },
            { name: "Pasta (cooked)", calories: 131, protein: 5, carbs: 25, fats: 1.1, category: "Carbs" },
            { name: "Sweet Potato (baked)", calories: 90, protein: 2, carbs: 21, fats: 0.2, category: "Carbs" },
            { name: "White Potato (baked)", calories: 93, protein: 2.5, carbs: 21, fats: 0.1, category: "Carbs" },
            { name: "Tortilla (flour)", calories: 312, protein: 8.2, carbs: 51, fats: 7.7, category: "Carbs" },
            { name: "Bagel", calories: 257, protein: 10, carbs: 50, fats: 1.7, category: "Carbs" },
            { name: "English Muffin", calories: 234, protein: 7.6, carbs: 46, fats: 2, category: "Carbs" },
            { name: "Pancakes", calories: 227, protein: 6.4, carbs: 28, fats: 9.7, category: "Carbs" },
            { name: "Waffles", calories: 291, protein: 7.3, carbs: 38, fats: 12, category: "Carbs" },
            { name: "Cereal (Cheerios)", calories: 367, protein: 11, carbs: 69, fats: 6.7, category: "Carbs" },
            { name: "Granola", calories: 471, protein: 13, carbs: 64, fats: 18, category: "Carbs" },
            
            // Fruits
            { name: "Banana", calories: 89, protein: 1.1, carbs: 23, fats: 0.3, category: "Fruits" },
            { name: "Apple", calories: 52, protein: 0.3, carbs: 14, fats: 0.2, category: "Fruits" },
            { name: "Orange", calories: 47, protein: 0.9, carbs: 12, fats: 0.1, category: "Fruits" },
            { name: "Strawberries", calories: 32, protein: 0.7, carbs: 7.7, fats: 0.3, category: "Fruits" },
            { name: "Blueberries", calories: 57, protein: 0.7, carbs: 14, fats: 0.3, category: "Fruits" },
            { name: "Grapes", calories: 69, protein: 0.7, carbs: 18, fats: 0.2, category: "Fruits" },
            { name: "Watermelon", calories: 30, protein: 0.6, carbs: 7.6, fats: 0.2, category: "Fruits" },
            { name: "Pineapple", calories: 50, protein: 0.5, carbs: 13, fats: 0.1, category: "Fruits" },
            { name: "Mango", calories: 60, protein: 0.8, carbs: 15, fats: 0.4, category: "Fruits" },
            { name: "Peach", calories: 39, protein: 0.9, carbs: 9.5, fats: 0.3, category: "Fruits" },
            
            // Vegetables
            { name: "Broccoli (raw)", calories: 34, protein: 2.8, carbs: 7, fats: 0.4, category: "Vegetables" },
            { name: "Spinach (raw)", calories: 23, protein: 2.9, carbs: 3.6, fats: 0.4, category: "Vegetables" },
            { name: "Carrots (raw)", calories: 41, protein: 0.9, carbs: 10, fats: 0.2, category: "Vegetables" },
            { name: "Tomato (raw)", calories: 18, protein: 0.9, carbs: 3.9, fats: 0.2, category: "Vegetables" },
            { name: "Cucumber (raw)", calories: 15, protein: 0.7, carbs: 3.6, fats: 0.1, category: "Vegetables" },
            { name: "Bell Pepper (raw)", calories: 31, protein: 1, carbs: 6, fats: 0.3, category: "Vegetables" },
            { name: "Lettuce (raw)", calories: 15, protein: 1.4, carbs: 2.9, fats: 0.2, category: "Vegetables" },
            { name: "Asparagus (raw)", calories: 20, protein: 2.2, carbs: 3.9, fats: 0.1, category: "Vegetables" },
            { name: "Cauliflower", calories: 25, protein: 1.9, carbs: 5, fats: 0.3, category: "Vegetables" },
            { name: "Green Beans", calories: 31, protein: 1.8, carbs: 7, fats: 0.2, category: "Vegetables" },
            { name: "Zucchini", calories: 17, protein: 1.2, carbs: 3.1, fats: 0.3, category: "Vegetables" },
            { name: "Mushrooms", calories: 22, protein: 3.1, carbs: 3.3, fats: 0.3, category: "Vegetables" },
            { name: "Onion", calories: 40, protein: 1.1, carbs: 9.3, fats: 0.1, category: "Vegetables" },
            
            // Fats/Oils/Nuts
            { name: "Almonds", calories: 579, protein: 21, carbs: 22, fats: 50, category: "Fats" },
            { name: "Peanuts", calories: 567, protein: 26, carbs: 16, fats: 49, category: "Fats" },
            { name: "Cashews", calories: 553, protein: 18, carbs: 30, fats: 44, category: "Fats" },
            { name: "Walnuts", calories: 654, protein: 15, carbs: 14, fats: 65, category: "Fats" },
            { name: "Peanut Butter", calories: 588, protein: 25, carbs: 20, fats: 50, category: "Fats" },
            { name: "Almond Butter", calories: 614, protein: 21, carbs: 19, fats: 56, category: "Fats" },
            { name: "Avocado", calories: 160, protein: 2, carbs: 9, fats: 15, category: "Fats" },
            { name: "Olive Oil", calories: 884, protein: 0, carbs: 0, fats: 100, category: "Fats" },
            { name: "Butter", calories: 717, protein: 0.9, carbs: 0.1, fats: 81, category: "Fats" },
            { name: "Cheese (Cheddar)", calories: 403, protein: 25, carbs: 1.3, fats: 33, category: "Fats" },
            { name: "Cheese (Mozzarella)", calories: 280, protein: 28, carbs: 2.2, fats: 17, category: "Fats" },
            { name: "Cream Cheese", calories: 342, protein: 5.9, carbs: 5.5, fats: 34, category: "Fats" },
            
            // Dairy
            { name: "Whole Milk", calories: 61, protein: 3.2, carbs: 4.8, fats: 3.3, category: "Dairy" },
            { name: "Skim Milk", calories: 34, protein: 3.4, carbs: 5, fats: 0.1, category: "Dairy" },
            { name: "Almond Milk (unsweetened)", calories: 13, protein: 0.4, carbs: 0.3, fats: 1.1, category: "Dairy" },
            { name: "Yogurt (plain, whole milk)", calories: 61, protein: 3.5, carbs: 4.7, fats: 3.3, category: "Dairy" },
            { name: "Sour Cream", calories: 193, protein: 2.4, carbs: 4.6, fats: 19, category: "Dairy" },
            
            // Fast Food - McDonald's
            { name: "Big Mac", calories: 257, protein: 13, carbs: 20, fats: 14, category: "Fast Food" },
            { name: "Quarter Pounder", calories: 244, protein: 14, carbs: 21, fats: 12, category: "Fast Food" },
            { name: "McNuggets (6pc)", calories: 287, protein: 16, carbs: 18, fats: 17, category: "Fast Food" },
            { name: "McChicken", calories: 358, protein: 14, carbs: 40, fats: 16, category: "Fast Food" },
            { name: "Filet-O-Fish", calories: 323, protein: 15, carbs: 36, fats: 13, category: "Fast Food" },
            { name: "French Fries (medium)", calories: 312, protein: 3.4, carbs: 41, fats: 15, category: "Fast Food" },
            { name: "Hash Browns", calories: 326, protein: 2.7, carbs: 33, fats: 20, category: "Fast Food" },
            { name: "Egg McMuffin", calories: 250, protein: 17, carbs: 27, fats: 8.7, category: "Fast Food" },
            
            // Fast Food - Chipotle
            { name: "Chipotle Chicken Bowl (avg)", calories: 165, protein: 32, carbs: 4, fats: 7, category: "Fast Food" },
            { name: "Chipotle Steak Bowl (avg)", calories: 150, protein: 21, carbs: 3, fats: 6, category: "Fast Food" },
            { name: "Chipotle Carnitas", calories: 210, protein: 32, carbs: 0, fats: 12, category: "Fast Food" },
            { name: "Chipotle White Rice", calories: 210, protein: 4, carbs: 40, fats: 4, category: "Fast Food" },
            { name: "Chipotle Black Beans", calories: 120, protein: 8, carbs: 23, fats: 1, category: "Fast Food" },
            { name: "Chipotle Guacamole", calories: 230, protein: 2, carbs: 8, fats: 22, category: "Fast Food" },
            
            // Fast Food - Subway
            { name: "Subway Turkey Breast (6in)", calories: 280, protein: 18, carbs: 46, fats: 3.5, category: "Fast Food" },
            { name: "Subway Italian BMT (6in)", calories: 410, protein: 19, carbs: 46, fats: 16, category: "Fast Food" },
            { name: "Subway Meatball Sub (6in)", calories: 480, protein: 21, carbs: 61, fats: 18, category: "Fast Food" },
            
            // Fast Food - Pizza
            { name: "Pizza (cheese)", calories: 266, protein: 11, carbs: 33, fats: 10, category: "Fast Food" },
            { name: "Pizza (pepperoni)", calories: 298, protein: 12, carbs: 34, fats: 13, category: "Fast Food" },
            { name: "Pizza (supreme)", calories: 264, protein: 11, carbs: 27, fats: 13, category: "Fast Food" },
            
            // Fast Food - Other
            { name: "Taco (beef)", calories: 226, protein: 9.7, carbs: 18, fats: 13, category: "Fast Food" },
            { name: "Burrito (beef & bean)", calories: 206, protein: 8.6, carbs: 25, fats: 7.7, category: "Fast Food" },
            { name: "Hot Dog", calories: 290, protein: 10, carbs: 24, fats: 17, category: "Fast Food" },
            { name: "Fried Chicken (breast)", calories: 246, protein: 25, carbs: 8.5, fats: 12, category: "Fast Food" },
            
            // Snacks
            { name: "Potato Chips", calories: 536, protein: 6.6, carbs: 53, fats: 34, category: "Snacks" },
            { name: "Pretzels", calories: 380, protein: 10, carbs: 79, fats: 3, category: "Snacks" },
            { name: "Popcorn (air-popped)", calories: 387, protein: 13, carbs: 78, fats: 4.5, category: "Snacks" },
            { name: "Popcorn (buttered)", calories: 500, protein: 9, carbs: 57, fats: 28, category: "Snacks" },
            { name: "Crackers (saltine)", calories: 421, protein: 9, carbs: 71, fats: 11, category: "Snacks" },
            { name: "Cheese Crackers", calories: 503, protein: 10, carbs: 58, fats: 25, category: "Snacks" },
            { name: "Trail Mix", calories: 462, protein: 13, carbs: 45, fats: 29, category: "Snacks" },
            { name: "Protein Bar", calories: 400, protein: 20, carbs: 44, fats: 15, category: "Snacks" },
            { name: "Granola Bar", calories: 471, protein: 10, carbs: 64, fats: 20, category: "Snacks" },
            { name: "Rice Cakes", calories: 387, protein: 8.2, carbs: 82, fats: 3.1, category: "Snacks" },
            { name: "Beef Jerky", calories: 410, protein: 33, carbs: 11, fats: 25, category: "Snacks" },
            { name: "String Cheese", calories: 318, protein: 25, carbs: 3.6, fats: 22, category: "Snacks" },
            { name: "Hummus", calories: 166, protein: 7.9, carbs: 14, fats: 9.6, category: "Snacks" },
            
            // Desserts
            { name: "Chocolate Chip Cookie", calories: 488, protein: 5.3, carbs: 68, fats: 23, category: "Desserts" },
            { name: "Brownie", calories: 466, protein: 6, carbs: 63, fats: 23, category: "Desserts" },
            { name: "Chocolate Cake", calories: 371, protein: 4.9, carbs: 50, fats: 17, category: "Desserts" },
            { name: "Vanilla Cake", calories: 389, protein: 4.6, carbs: 58, fats: 16, category: "Desserts" },
            { name: "Ice Cream (vanilla)", calories: 207, protein: 3.5, carbs: 24, fats: 11, category: "Desserts" },
            { name: "Ice Cream (chocolate)", calories: 216, protein: 3.8, carbs: 28, fats: 11, category: "Desserts" },
            { name: "Donut (glazed)", calories: 452, protein: 4.9, carbs: 51, fats: 25, category: "Desserts" },
            { name: "Donut (chocolate)", calories: 424, protein: 4.5, carbs: 47, fats: 24, category: "Desserts" },
            { name: "Candy Bar (Snickers)", calories: 488, protein: 9.3, carbs: 60, fats: 24, category: "Desserts" },
            { name: "Candy Bar (Kit Kat)", calories: 518, protein: 6.9, carbs: 64, fats: 26, category: "Desserts" },
            { name: "M&Ms", calories: 492, protein: 4.9, carbs: 70, fats: 21, category: "Desserts" },
            { name: "Gummy Bears", calories: 325, protein: 6.9, carbs: 77, fats: 0, category: "Desserts" },
            { name: "Oreos", calories: 480, protein: 4.7, carbs: 68, fats: 21, category: "Desserts" },
            { name: "Cheesecake", calories: 321, protein: 5.5, carbs: 25, fats: 23, category: "Desserts" },
            { name: "Apple Pie", calories: 237, protein: 2, carbs: 34, fats: 11, category: "Desserts" },
            { name: "Chocolate (dark)", calories: 598, protein: 7.8, carbs: 46, fats: 43, category: "Desserts" },
            { name: "Chocolate (milk)", calories: 535, protein: 7.6, carbs: 59, fats: 30, category: "Desserts" },
            
            // Beverages
            { name: "Coca-Cola", calories: 42, protein: 0, carbs: 11, fats: 0, category: "Beverages" },
            { name: "Orange Juice", calories: 45, protein: 0.7, carbs: 10, fats: 0.2, category: "Beverages" },
            { name: "Apple Juice", calories: 46, protein: 0.1, carbs: 11, fats: 0.1, category: "Beverages" },
            { name: "Coffee (black)", calories: 2, protein: 0.3, carbs: 0, fats: 0, category: "Beverages" },
            { name: "Latte (whole milk)", calories: 61, protein: 3.2, carbs: 4.8, fats: 3.3, category: "Beverages" },
            { name: "Cappuccino", calories: 38, protein: 2.1, carbs: 3.7, fats: 1.5, category: "Beverages" },
            { name: "Beer (regular)", calories: 43, protein: 0.5, carbs: 3.6, fats: 0, category: "Beverages" },
            { name: "Wine (red)", calories: 85, protein: 0.1, carbs: 2.6, fats: 0, category: "Beverages" },
            { name: "Protein Shake (whey)", calories: 103, protein: 20, carbs: 3, fats: 1, category: "Beverages" },
            { name: "Gatorade", calories: 26, protein: 0, carbs: 6.7, fats: 0, category: "Beverages" },
            
            // International - Mexican
            { name: "Quesadilla (cheese)", calories: 234, protein: 10, carbs: 24, fats: 11, category: "Mexican" },
            { name: "Enchilada", calories: 143, protein: 6.6, carbs: 12, fats: 7.9, category: "Mexican" },
            { name: "Fajitas (chicken)", calories: 131, protein: 12, carbs: 6.7, fats: 6.2, category: "Mexican" },
            { name: "Nachos", calories: 346, protein: 9.2, carbs: 36, fats: 19, category: "Mexican" },
            { name: "Refried Beans", calories: 91, protein: 5.4, carbs: 15, fats: 1.2, category: "Mexican" },
            { name: "Spanish Rice", calories: 150, protein: 3, carbs: 28, fats: 3, category: "Mexican" },
            { name: "Salsa", calories: 36, protein: 1.5, carbs: 8.4, fats: 0.2, category: "Mexican" },
            { name: "Guacamole", calories: 160, protein: 2, carbs: 9, fats: 15, category: "Mexican" },
            
            // International - Italian
            { name: "Spaghetti with Meatballs", calories: 134, protein: 6.5, carbs: 15, fats: 5.3, category: "Italian" },
            { name: "Lasagna", calories: 135, protein: 8, carbs: 11, fats: 6.5, category: "Italian" },
            { name: "Fettuccine Alfredo", calories: 155, protein: 5, carbs: 16, fats: 8, category: "Italian" },
            { name: "Ravioli (cheese)", calories: 175, protein: 6.6, carbs: 24, fats: 5.9, category: "Italian" },
            { name: "Garlic Bread", calories: 350, protein: 9, carbs: 43, fats: 15, category: "Italian" },
            { name: "Tiramisu", calories: 262, protein: 4.6, carbs: 30, fats: 14, category: "Italian" },
            
            // International - Asian
            { name: "Fried Rice", calories: 163, protein: 3.7, carbs: 28, fats: 4.1, category: "Asian" },
            { name: "Lo Mein", calories: 157, protein: 5.3, carbs: 25, fats: 4, category: "Asian" },
            { name: "Pad Thai", calories: 153, protein: 5.6, carbs: 19, fats: 6.2, category: "Asian" },
            { name: "Sushi (California Roll)", calories: 119, protein: 3.5, carbs: 18, fats: 3.6, category: "Asian" },
            { name: "Sushi (Salmon)", calories: 142, protein: 6, carbs: 18, fats: 5.3, category: "Asian" },
            { name: "Ramen (restaurant)", calories: 436, protein: 19, carbs: 65, fats: 11, category: "Asian" },
            { name: "Orange Chicken", calories: 280, protein: 15, carbs: 28, fats: 12, category: "Asian" },
            { name: "General Tso's Chicken", calories: 295, protein: 13, carbs: 35, fats: 11, category: "Asian" },
            { name: "Spring Roll", calories: 138, protein: 3.5, carbs: 21, fats: 4.7, category: "Asian" },
            { name: "Dumplings (pork)", calories: 210, protein: 8.5, carbs: 23, fats: 9, category: "Asian" },
            { name: "Teriyaki Chicken", calories: 166, protein: 13, carbs: 13, fats: 7.4, category: "Asian" },
            { name: "Pho (beef)", calories: 215, protein: 15, carbs: 25, fats: 5.5, category: "Asian" },
            
            // International - Indian
            { name: "Chicken Tikka Masala", calories: 119, protein: 7.6, carbs: 5.8, fats: 7.2, category: "Indian" },
            { name: "Butter Chicken", calories: 151, protein: 9.6, carbs: 5.3, fats: 10, category: "Indian" },
            { name: "Naan Bread", calories: 262, protein: 7.6, carbs: 45, fats: 5.6, category: "Indian" },
            { name: "Samosa", calories: 262, protein: 4.3, carbs: 28, fats: 15, category: "Indian" },
            { name: "Biryani (chicken)", calories: 170, protein: 8, carbs: 22, fats: 5.5, category: "Indian" },
            
            // Common Meals
            { name: "Grilled Chicken Salad", calories: 112, protein: 14, carbs: 4.5, fats: 4.5, category: "Meals" },
            { name: "Caesar Salad", calories: 190, protein: 4.6, carbs: 7.3, fats: 16, category: "Meals" },
            { name: "Cobb Salad", calories: 155, protein: 10, carbs: 4, fats: 11, category: "Meals" },
            { name: "BLT Sandwich", calories: 267, protein: 10, carbs: 25, fats: 14, category: "Meals" },
            { name: "Club Sandwich", calories: 245, protein: 14, carbs: 24, fats: 11, category: "Meals" },
            { name: "Grilled Cheese", calories: 291, protein: 11, carbs: 28, fats: 15, category: "Meals" },
            { name: "PB&J Sandwich", calories: 327, protein: 11, carbs: 46, fats: 12, category: "Meals" },
            { name: "Chicken Noodle Soup", calories: 75, protein: 4, carbs: 9, fats: 2.5, category: "Meals" },
            { name: "Tomato Soup", calories: 74, protein: 2, carbs: 16, fats: 0.6, category: "Meals" },
            { name: "Chili (beef)", calories: 143, protein: 10, carbs: 13, fats: 5.8, category: "Meals" },
            { name: "Mac and Cheese", calories: 164, protein: 6.4, carbs: 18, fats: 7.3, category: "Meals" },
            { name: "Chicken Parmesan", calories: 197, protein: 16, carbs: 10, fats: 10, category: "Meals" },
            { name: "Meatloaf", calories: 245, protein: 17, carbs: 9, fats: 16, category: "Meals" },
            { name: "Pot Roast", calories: 201, protein: 20, carbs: 8, fats: 9.5, category: "Meals" },
            { name: "Stir Fry (chicken & veg)", calories: 121, protein: 11, carbs: 9, fats: 4.8, category: "Meals" },
            
            // Chicken - More Varieties
            { name: "Chicken Breast (grilled, seasoned)", calories: 165, protein: 31, carbs: 0, fats: 3.6, category: "Protein" },
            { name: "Chicken Breast (baked)", calories: 165, protein: 31, carbs: 0, fats: 3.6, category: "Protein" },
            { name: "Chicken Breast (rotisserie)", calories: 190, protein: 29, carbs: 0, fats: 7.4, category: "Protein" },
            { name: "Chicken Tender (breaded)", calories: 220, protein: 17, carbs: 14, fats: 11, category: "Protein" },
            { name: "Chicken Cutlet (breaded)", calories: 246, protein: 19, carbs: 15, fats: 12, category: "Protein" },
            { name: "BBQ Chicken", calories: 176, protein: 26, carbs: 7, fats: 4.6, category: "Protein" },
            { name: "Buffalo Chicken", calories: 180, protein: 24, carbs: 2, fats: 8, category: "Protein" },
            { name: "Chicken Sausage", calories: 160, protein: 15, carbs: 3, fats: 9, category: "Protein" },
            { name: "Chicken Nuggets (frozen)", calories: 296, protein: 15, carbs: 18, fats: 18, category: "Fast Food" },
            
            // Sandwiches & Wraps - Ready Made
            { name: "Turkey & Cheese Sandwich", calories: 272, protein: 16, carbs: 26, fats: 11, category: "Sandwiches" },
            { name: "Ham & Cheese Sandwich", calories: 290, protein: 17, carbs: 28, fats: 13, category: "Sandwiches" },
            { name: "Tuna Salad Sandwich", calories: 287, protein: 13, carbs: 29, fats: 13, category: "Sandwiches" },
            { name: "Chicken Salad Sandwich", calories: 322, protein: 14, carbs: 28, fats: 17, category: "Sandwiches" },
            { name: "Egg Salad Sandwich", calories: 285, protein: 10, carbs: 28, fats: 15, category: "Sandwiches" },
            { name: "Italian Sub", calories: 236, protein: 13, carbs: 24, fats: 10, category: "Sandwiches" },
            { name: "Roast Beef Sandwich", calories: 245, protein: 19, carbs: 25, fats: 8, category: "Sandwiches" },
            { name: "Chicken Caesar Wrap", calories: 209, protein: 12, carbs: 22, fats: 8.5, category: "Sandwiches" },
            { name: "Turkey Wrap", calories: 200, protein: 14, carbs: 24, fats: 6, category: "Sandwiches" },
            { name: "Veggie Wrap", calories: 178, protein: 6, carbs: 28, fats: 5.5, category: "Sandwiches" },
            
            // Frozen Meals - Popular Brands
            { name: "Frozen Burrito (bean & cheese)", calories: 272, protein: 9, carbs: 43, fats: 7.5, category: "Frozen" },
            { name: "Frozen Burrito (beef)", calories: 295, protein: 11, carbs: 41, fats: 9.8, category: "Frozen" },
            { name: "Frozen Pizza (personal)", calories: 266, protein: 11, carbs: 33, fats: 10, category: "Frozen" },
            { name: "Hot Pocket (pepperoni)", calories: 296, protein: 11, carbs: 36, fats: 12, category: "Frozen" },
            { name: "Hot Pocket (ham & cheese)", calories: 287, protein: 12, carbs: 35, fats: 11, category: "Frozen" },
            { name: "Lean Cuisine (chicken)", calories: 240, protein: 17, carbs: 30, fats: 6, category: "Frozen" },
            { name: "Healthy Choice (turkey)", calories: 220, protein: 16, carbs: 28, fats: 5, category: "Frozen" },
            { name: "Stouffer's Mac & Cheese", calories: 164, protein: 6.4, carbs: 18, fats: 7.3, category: "Frozen" },
            { name: "Stouffer's Lasagna", calories: 135, protein: 8, carbs: 11, fats: 6.5, category: "Frozen" },
            { name: "Frozen Chicken Alfredo", calories: 155, protein: 8, carbs: 16, fats: 6.5, category: "Frozen" },
            { name: "Frozen Shrimp Scampi", calories: 138, protein: 10, carbs: 12, fats: 5.8, category: "Frozen" },
            { name: "Frozen Salisbury Steak", calories: 186, protein: 14, carbs: 10, fats: 10, category: "Frozen" },
            { name: "Frozen Meatloaf Dinner", calories: 245, protein: 17, carbs: 22, fats: 10, category: "Frozen" },
            { name: "Frozen Pot Pie (chicken)", calories: 225, protein: 8, carbs: 23, fats: 11, category: "Frozen" },
            { name: "Bagel Bites", calories: 236, protein: 9.4, carbs: 31, fats: 8.2, category: "Frozen" },
            { name: "Pizza Rolls", calories: 222, protein: 7.8, carbs: 29, fats: 8.9, category: "Frozen" },
            { name: "Frozen Corn Dogs", calories: 225, protein: 6.7, carbs: 25, fats: 10, category: "Frozen" },
            { name: "Frozen Fish Sticks", calories: 277, protein: 11, carbs: 22, fats: 16, category: "Frozen" },
            { name: "Frozen Popcorn Chicken", calories: 296, protein: 15, carbs: 18, fats: 18, category: "Frozen" },
            
            // Pasta Dishes - Prepared
            { name: "Chicken Pesto Pasta", calories: 167, protein: 9, carbs: 18, fats: 6.5, category: "Pasta" },
            { name: "Chicken Alfredo Pasta", calories: 155, protein: 8, carbs: 16, fats: 6.5, category: "Pasta" },
            { name: "Shrimp Alfredo", calories: 138, protein: 10, carbs: 12, fats: 5.8, category: "Pasta" },
            { name: "Spaghetti Bolognese", calories: 134, protein: 7, carbs: 15, fats: 5.5, category: "Pasta" },
            { name: "Spaghetti Carbonara", calories: 166, protein: 7.8, carbs: 15, fats: 8.4, category: "Pasta" },
            { name: "Penne Arrabbiata", calories: 131, protein: 4.2, carbs: 25, fats: 1.8, category: "Pasta" },
            { name: "Penne Vodka", calories: 159, protein: 5.6, carbs: 20, fats: 6.2, category: "Pasta" },
            { name: "Baked Ziti", calories: 148, protein: 7.5, carbs: 16, fats: 5.8, category: "Pasta" },
            { name: "Stuffed Shells", calories: 142, protein: 7.2, carbs: 15, fats: 5.9, category: "Pasta" },
            { name: "Tortellini (cheese)", calories: 200, protein: 8.5, carbs: 30, fats: 5.2, category: "Pasta" },
            { name: "Macaroni Salad", calories: 192, protein: 3.6, carbs: 22, fats: 10, category: "Pasta" },
            
            // More International - Middle Eastern
            { name: "Falafel", calories: 333, protein: 13, carbs: 32, fats: 18, category: "Middle Eastern" },
            { name: "Shawarma (chicken)", calories: 165, protein: 18, carbs: 5, fats: 8, category: "Middle Eastern" },
            { name: "Shawarma (beef)", calories: 215, protein: 16, carbs: 6, fats: 14, category: "Middle Eastern" },
            { name: "Gyro (lamb)", calories: 217, protein: 11, carbs: 21, fats: 10, category: "Middle Eastern" },
            { name: "Kebab (chicken)", calories: 165, protein: 25, carbs: 2, fats: 6, category: "Middle Eastern" },
            { name: "Kebab (beef)", calories: 250, protein: 21, carbs: 2, fats: 18, category: "Middle Eastern" },
            { name: "Tabbouleh", calories: 104, protein: 3, carbs: 16, fats: 3.8, category: "Middle Eastern" },
            { name: "Baba Ganoush", calories: 96, protein: 2.4, carbs: 9.6, fats: 5.9, category: "Middle Eastern" },
            { name: "Pita Bread", calories: 275, protein: 9, carbs: 56, fats: 1.2, category: "Middle Eastern" },
            
            // More International - Thai
            { name: "Thai Green Curry", calories: 135, protein: 7, carbs: 12, fats: 7, category: "Thai" },
            { name: "Thai Red Curry", calories: 142, protein: 8, carbs: 11, fats: 8, category: "Thai" },
            { name: "Tom Yum Soup", calories: 87, protein: 9, carbs: 8, fats: 2.5, category: "Thai" },
            { name: "Som Tam (papaya salad)", calories: 78, protein: 2.5, carbs: 16, fats: 0.5, category: "Thai" },
            { name: "Massaman Curry", calories: 168, protein: 9, carbs: 14, fats: 9, category: "Thai" },
            
            // More International - Japanese
            { name: "Chicken Teriyaki Bowl", calories: 166, protein: 13, carbs: 20, fats: 4, category: "Japanese" },
            { name: "Beef Teriyaki Bowl", calories: 195, protein: 15, carbs: 22, fats: 6, category: "Japanese" },
            { name: "Tempura (shrimp)", calories: 200, protein: 8, carbs: 20, fats: 10, category: "Japanese" },
            { name: "Tempura (vegetable)", calories: 150, protein: 3, carbs: 22, fats: 6, category: "Japanese" },
            { name: "Miso Soup", calories: 40, protein: 2.2, carbs: 5.4, fats: 1.2, category: "Japanese" },
            { name: "Edamame", calories: 122, protein: 11, carbs: 10, fats: 5, category: "Japanese" },
            { name: "Gyoza (pork)", calories: 210, protein: 8.5, carbs: 23, fats: 9, category: "Japanese" },
            { name: "Yakisoba", calories: 155, protein: 5.5, carbs: 26, fats: 3.8, category: "Japanese" },
            { name: "Udon Noodle Soup", calories: 115, protein: 4, carbs: 23, fats: 1, category: "Japanese" },
            { name: "Katsu Curry", calories: 178, protein: 10, carbs: 20, fats: 7, category: "Japanese" },
            
            // More International - Korean
            { name: "Bibimbap", calories: 156, protein: 8, carbs: 22, fats: 4.2, category: "Korean" },
            { name: "Bulgogi (beef)", calories: 195, protein: 18, carbs: 10, fats: 9, category: "Korean" },
            { name: "Korean Fried Chicken", calories: 280, protein: 16, carbs: 15, fats: 18, category: "Korean" },
            { name: "Kimchi", calories: 15, protein: 1.1, carbs: 2.4, fats: 0.5, category: "Korean" },
            { name: "Japchae (noodles)", calories: 143, protein: 3, carbs: 26, fats: 3.2, category: "Korean" },
            
            // More International - Vietnamese
            { name: "Banh Mi Sandwich", calories: 350, protein: 15, carbs: 42, fats: 13, category: "Vietnamese" },
            { name: "Vietnamese Spring Rolls", calories: 68, protein: 2.5, carbs: 12, fats: 1.5, category: "Vietnamese" },
            { name: "Bun (vermicelli bowl)", calories: 145, protein: 10, carbs: 24, fats: 2, category: "Vietnamese" },
            
            // More International - Greek
            { name: "Greek Salad", calories: 106, protein: 3.8, carbs: 7.2, fats: 7.5, category: "Greek" },
            { name: "Gyro Platter", calories: 217, protein: 11, carbs: 21, fats: 10, category: "Greek" },
            { name: "Spanakopita", calories: 259, protein: 9, carbs: 20, fats: 16, category: "Greek" },
            { name: "Moussaka", calories: 176, protein: 9, carbs: 13, fats: 10, category: "Greek" },
            { name: "Tzatziki", calories: 54, protein: 2, carbs: 3.6, fats: 3.8, category: "Greek" },
            
            // Deli/Prepared Foods
            { name: "Rotisserie Chicken (dark meat)", calories: 205, protein: 27, carbs: 0, fats: 10, category: "Deli" },
            { name: "Rotisserie Chicken (white meat)", calories: 142, protein: 27, carbs: 0, fats: 3, category: "Deli" },
            { name: "Potato Salad", calories: 143, protein: 2.6, carbs: 13, fats: 9, category: "Deli" },
            { name: "Coleslaw", calories: 83, protein: 0.9, carbs: 7.5, fats: 6.2, category: "Deli" },
            { name: "Chicken Salad (deli)", calories: 200, protein: 10, carbs: 4, fats: 16, category: "Deli" },
            { name: "Tuna Salad (deli)", calories: 187, protein: 16, carbs: 9.6, fats: 9.5, category: "Deli" },
            { name: "Deviled Eggs", calories: 147, protein: 6.3, carbs: 0.6, fats: 13, category: "Deli" },
            
            // Breakfast Items - More Variety
            { name: "Breakfast Burrito", calories: 262, protein: 12, carbs: 26, fats: 12, category: "Breakfast" },
            { name: "Breakfast Sandwich", calories: 290, protein: 15, carbs: 28, fats: 13, category: "Breakfast" },
            { name: "Sausage Egg & Cheese", calories: 441, protein: 20, carbs: 31, fats: 26, category: "Breakfast" },
            { name: "Bacon Egg & Cheese", calories: 388, protein: 18, carbs: 30, fats: 21, category: "Breakfast" },
            { name: "Breakfast Pizza", calories: 262, protein: 11, carbs: 28, fats: 12, category: "Breakfast" },
            { name: "French Toast Sticks", calories: 310, protein: 6, carbs: 45, fats: 12, category: "Breakfast" },
            { name: "Sausage Biscuit", calories: 415, protein: 10, carbs: 32, fats: 28, category: "Breakfast" },
            { name: "Croissant (plain)", calories: 406, protein: 8.2, carbs: 46, fats: 21, category: "Breakfast" },
            { name: "Croissant (chocolate)", calories: 414, protein: 7.4, carbs: 47, fats: 22, category: "Breakfast" },
            { name: "Muffin (blueberry)", calories: 313, protein: 4.7, carbs: 54, fats: 8.5, category: "Breakfast" },
            { name: "Muffin (chocolate chip)", calories: 425, protein: 5.3, carbs: 55, fats: 21, category: "Breakfast" },
            { name: "Cinnamon Roll", calories: 420, protein: 6.5, carbs: 58, fats: 18, category: "Breakfast" },
            { name: "Pop Tart", calories: 400, protein: 4, carbs: 70, fats: 11, category: "Breakfast" },
            { name: "Toaster Strudel", calories: 370, protein: 4.5, carbs: 51, fats: 16, category: "Breakfast" },
            
            // Condiments & Sauces (per serving ~15g)
            { name: "Ketchup", calories: 17, protein: 0.2, carbs: 4.5, fats: 0, category: "Condiments" },
            { name: "Mustard", calories: 5, protein: 0.3, carbs: 0.5, fats: 0.3, category: "Condiments" },
            { name: "Mayo", calories: 94, protein: 0.1, carbs: 0.1, fats: 10.3, category: "Condiments" },
            { name: "Ranch Dressing", calories: 73, protein: 0.4, carbs: 1.4, fats: 7.7, category: "Condiments" },
            { name: "Caesar Dressing", calories: 78, protein: 0.5, carbs: 0.5, fats: 8.5, category: "Condiments" },
            { name: "Italian Dressing", calories: 43, protein: 0.1, carbs: 1.5, fats: 4.2, category: "Condiments" },
            { name: "BBQ Sauce", calories: 29, protein: 0.3, carbs: 7, fats: 0.1, category: "Condiments" },
            { name: "Hot Sauce", calories: 1, protein: 0.1, carbs: 0.1, fats: 0, category: "Condiments" },
            { name: "Soy Sauce", calories: 8, protein: 1.3, carbs: 0.8, fats: 0, category: "Condiments" },
            { name: "Teriyaki Sauce", calories: 16, protein: 0.6, carbs: 2.9, fats: 0, category: "Condiments" },
            { name: "Pesto Sauce", calories: 80, protein: 2.5, carbs: 2, fats: 7.5, category: "Condiments" },
            { name: "Marinara Sauce", calories: 24, protein: 0.8, carbs: 5, fats: 0.5, category: "Condiments" },
            { name: "Alfredo Sauce", calories: 97, protein: 1.8, carbs: 3.2, fats: 9.2, category: "Condiments" },
        ];

        // Load data from localStorage
        function loadData() {
            // Try new date-based structure first
            const savedByDate = localStorage.getItem('nutritionDataByDate');
            if (savedByDate) {
                foodsByDate = JSON.parse(savedByDate);
            } else {
                // Migrate old data if exists
                const oldSaved = localStorage.getItem('nutritionData');
                if (oldSaved) {
                    const oldFoods = JSON.parse(oldSaved);
                    const todayKey = getTodayKey();
                    foodsByDate[todayKey] = oldFoods;
                    localStorage.setItem('nutritionDataByDate', JSON.stringify(foodsByDate));
                    localStorage.removeItem('nutritionData'); // Clean up old storage
                }
            }
            
            // Load today's foods
            const todayKey = getTodayKey();
            foods = foodsByDate[todayKey] || [];
            
            const goals = localStorage.getItem('nutritionGoals');
            if (goals) {
                const g = JSON.parse(goals);
                document.getElementById('goalCalories').value = g.calories;
                document.getElementById('goalProtein').value = g.protein;
                document.getElementById('goalCarbs').value = g.carbs;
                document.getElementById('goalFats').value = g.fats;
            }
            const bodyStats = localStorage.getItem('bodyStats');
            if (bodyStats) {
                const stats = JSON.parse(bodyStats);
                document.getElementById('currentWeight').value = stats.currentWeight || '';
                document.getElementById('height').value = stats.height || '';
                document.getElementById('goalWeight').value = stats.goalWeight || '';
                document.getElementById('age').value = stats.age || '';
                document.getElementById('gender').value = stats.gender || 'male';
                document.getElementById('activityLevel').value = stats.activityLevel || '1.55';
            }
        }

        function saveData() {
            const todayKey = getTodayKey();
            foodsByDate[todayKey] = foods;
            localStorage.setItem('nutritionDataByDate', JSON.stringify(foodsByDate));
        }

        function getTodayKey() {
            const d = new Date();
            return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
        }

        function getDateKey(date) {
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        }

        function saveBodyStats() {
            const stats = {
                currentWeight: parseFloat(document.getElementById('currentWeight').value) || null,
                height: parseFloat(document.getElementById('height').value) || null,
                goalWeight: parseFloat(document.getElementById('goalWeight').value) || null,
                age: parseFloat(document.getElementById('age').value) || null,
                gender: document.getElementById('gender').value,
                activityLevel: parseFloat(document.getElementById('activityLevel').value)
            };
            localStorage.setItem('bodyStats', JSON.stringify(stats));
        }

        function calculateCalories() {
            const weight = parseFloat(document.getElementById('currentWeight').value);
            const height = parseFloat(document.getElementById('height').value);
            const age = parseFloat(document.getElementById('age').value);
            const gender = document.getElementById('gender').value;
            const activityLevel = parseFloat(document.getElementById('activityLevel').value);

            if (!weight || !height || !age) {
                alert('Please fill in your weight, height, and age to calculate calories');
                return;
            }

            // Convert to metric for calculation
            const weightKg = weight * 0.453592;
            const heightCm = height * 2.54;

            // Mifflin-St Jeor Equation for BMR
            let bmr;
            if (gender === 'male') {
                bmr = (10 * weightKg) + (6.25 * heightCm) - (5 * age) + 5;
            } else {
                bmr = (10 * weightKg) + (6.25 * heightCm) - (5 * age) - 161;
            }

            // Calculate TDEE (Total Daily Energy Expenditure)
            const tdee = bmr * activityLevel;

            // Calculate deficit (500 cal below TDEE for ~1lb/week loss)
            const deficit = tdee - 500;

            // Calculate surplus (300 cal above TDEE for ~0.5lb/week gain)
            const surplus = tdee + 300;

            // Display results
            document.getElementById('bmrValue').textContent = Math.round(bmr) + ' cal';
            document.getElementById('tdeeValue').textContent = Math.round(tdee) + ' cal';
            document.getElementById('deficitValue').textContent = Math.round(deficit) + ' cal';
            document.getElementById('surplusValue').textContent = Math.round(surplus) + ' cal';

            document.getElementById('calculatorResults').style.display = 'block';
            document.getElementById('calculatorPrompt').style.display = 'none';

            // Store calculated values for easy application
            window.calculatedCalories = {
                deficit: Math.round(deficit),
                maintenance: Math.round(tdee),
                surplus: Math.round(surplus)
            };
        }

        function applyCalories(type) {
            if (!window.calculatedCalories) {
                alert('Please calculate calories first');
                return;
            }

            const calories = window.calculatedCalories[type];
            const weight = parseFloat(document.getElementById('currentWeight').value) || 150;
            
            // Calculate protein based on goal type
            let protein, proteinMultiplier;
            if (type === 'deficit') {
                // Weight loss: 1.2g per lb to preserve muscle
                proteinMultiplier = 1.2;
                protein = Math.round(weight * proteinMultiplier);
            } else if (type === 'surplus') {
                // Weight gain/muscle building: 1.0-1.2g per lb
                proteinMultiplier = 1.1;
                protein = Math.round(weight * proteinMultiplier);
            } else {
                // Maintenance: 0.8-1.0g per lb
                proteinMultiplier = 0.9;
                protein = Math.round(weight * proteinMultiplier);
            }

            // Fats: 25-30% of calories (using 27.5%)
            const fats = Math.round((calories * 0.275) / 9);

            // Carbs: remaining calories
            const remainingCalories = calories - (protein * 4) - (fats * 9);
            const carbs = Math.round(remainingCalories / 4);

            document.getElementById('goalCalories').value = calories;
            document.getElementById('goalProtein').value = protein;
            document.getElementById('goalCarbs').value = carbs;
            document.getElementById('goalFats').value = fats;

            // Show recommendations with explanation
            const recommendations = document.getElementById('macroRecommendations');
            let goalTypeText = type === 'deficit' ? 'Weight Loss' : type === 'surplus' ? 'Muscle Gain' : 'Maintenance';
            
            recommendations.innerHTML = `
                <strong>${goalTypeText} Mode:</strong><br>
                ‚Ä¢ Protein: ${protein}g (${proteinMultiplier}g per lb √ó ${weight} lbs)<br>
                ‚Ä¢ Carbs: ${carbs}g (remaining energy after protein/fats)<br>
                ‚Ä¢ Fats: ${fats}g (~27.5% of calories for hormone health)
            `;
            document.getElementById('recommendedMacros').style.display = 'block';

            saveGoals();
            
            alert(`Applied ${goalTypeText} calories: ${calories}\nProtein: ${protein}g | Carbs: ${carbs}g | Fats: ${fats}g`);
        }

        function saveData() {
            localStorage.setItem('nutritionData', JSON.stringify(foods));
        }

        function saveGoals() {
            const goals = {
                calories: parseInt(document.getElementById('goalCalories').value) || 2000,
                protein: parseInt(document.getElementById('goalProtein').value) || 150,
                carbs: parseInt(document.getElementById('goalCarbs').value) || 200,
                fats: parseInt(document.getElementById('goalFats').value) || 65
            };
            localStorage.setItem('nutritionGoals', JSON.stringify(goals));
            updateStats();
        }

        function getGoals() {
            const saved = localStorage.getItem('nutritionGoals');
            if (saved) {
                return JSON.parse(saved);
            }
            return {
                calories: 2000,
                protein: 150,
                carbs: 200,
                fats: 65
            };
        }

        function searchFood() {
            const query = document.getElementById('foodSearch').value.toLowerCase();
            const resultsDiv = document.getElementById('searchResults');
            
            if (query.length < 2) {
                resultsDiv.style.display = 'none';
                return;
            }

            const matches = foodDatabase.filter(food => 
                food.name.toLowerCase().includes(query)
            ).slice(0, 10);

            if (matches.length === 0) {
                resultsDiv.style.display = 'none';
                return;
            }

            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = matches.map(food => `
                <div style="padding: 12px; border-bottom: 1px solid #e9ecef; cursor: pointer; display: flex; justify-content: space-between; align-items: center;" 
                     onclick="selectFood('${food.name}')"
                     onmouseover="this.style.background='#f8f9fa'" 
                     onmouseout="this.style.background='white'">
                    <div>
                        <div style="font-weight: 600; font-size: 14px;">${food.name}</div>
                        <div style="font-size: 12px; color: #6c757d;">${food.category} ‚Ä¢ ${food.calories} cal/100g</div>
                    </div>
                    <div style="font-size: 12px; color: #6c757d;">
                        P: ${food.protein}g C: ${food.carbs}g F: ${food.fats}g
                    </div>
                </div>
            `).join('');
        }

        function selectFood(foodName) {
            selectedFood = foodDatabase.find(f => f.name === foodName);
            document.getElementById('selectedFoodName').textContent = selectedFood.name;
            document.getElementById('nutritionInfo').textContent = 
                `${selectedFood.calories} cal ‚Ä¢ Protein: ${selectedFood.protein}g ‚Ä¢ Carbs: ${selectedFood.carbs}g ‚Ä¢ Fats: ${selectedFood.fats}g`;
            
            document.getElementById('portionSize').value = 100;
            updatePortionPreview();
            
            document.getElementById('searchResults').style.display = 'none';
            document.getElementById('portionEntry').style.display = 'block';
            document.getElementById('foodSearch').value = '';
        }

        function updatePortionPreview() {
            if (!selectedFood) return;
            
            const portion = parseFloat(document.getElementById('portionSize').value) || 0;
            const multiplier = portion / 100;
            
            const calories = Math.round(selectedFood.calories * multiplier);
            const protein = Math.round(selectedFood.protein * multiplier * 10) / 10;
            const carbs = Math.round(selectedFood.carbs * multiplier * 10) / 10;
            const fats = Math.round(selectedFood.fats * multiplier * 10) / 10;
            
            document.getElementById('portionPreview').textContent = 
                `${calories} cal ‚Ä¢ Protein: ${protein}g ‚Ä¢ Carbs: ${carbs}g ‚Ä¢ Fats: ${fats}g`;
        }

        function addFoodFromDatabase() {
            if (!selectedFood) return;
            
            const portion = parseFloat(document.getElementById('portionSize').value) || 0;
            if (portion <= 0) {
                alert('Please enter a valid portion size');
                return;
            }
            
            const multiplier = portion / 100;
            
            const food = {
                name: `${selectedFood.name} (${portion}g)`,
                calories: selectedFood.calories * multiplier,
                protein: selectedFood.protein * multiplier,
                carbs: selectedFood.carbs * multiplier,
                fats: selectedFood.fats * multiplier,
                id: Date.now()
            };
            
            foods.push(food);
            saveData();
            renderFoodList();
            cancelSelection();
        }

        function cancelSelection() {
            selectedFood = null;
            document.getElementById('portionEntry').style.display = 'none';
            document.getElementById('foodSearch').value = '';
        }

        function addManualFood() {
            const name = document.getElementById('manualFoodName').value;
            const calories = parseFloat(document.getElementById('manualCalories').value) || 0;
            const protein = parseFloat(document.getElementById('manualProtein').value) || 0;
            const carbs = parseFloat(document.getElementById('manualCarbs').value) || 0;
            const fats = parseFloat(document.getElementById('manualFats').value) || 0;

            if (!name) {
                alert('Please enter a food name');
                return;
            }

            const food = { name, calories, protein, carbs, fats, id: Date.now() };
            foods.push(food);
            saveData();
            
            // Clear inputs
            document.getElementById('manualFoodName').value = '';
            document.getElementById('manualCalories').value = '';
            document.getElementById('manualProtein').value = '';
            document.getElementById('manualCarbs').value = '';
            document.getElementById('manualFats').value = '';

            renderFoodList();
        }

        function switchTab(event, tabName) {
            document.querySelectorAll('.tab-dock').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.currentTarget.classList.add('active');
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'stats') {
                updateStats();
            } else if (tabName === 'goals') {
                updateGoalProgress();
            } else if (tabName === 'calendar') {
                renderCalendar();
            }
        }

        function magnifyTab(event) {
            const tab = event.currentTarget;
            const rect = tab.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const centerX = rect.width / 2;
            const distance = Math.abs(x - centerX);
            const maxDistance = rect.width / 2;
            
            // Calculate scale based on mouse position (closer to center = bigger)
            const normalizedDistance = 1 - (distance / maxDistance);
            const scaleBonus = normalizedDistance * 0.1; // Up to 10% extra scale
            
            const baseScale = tab.classList.contains('active') ? 1.05 : 1.0;
            const hoverScale = 1.15 + scaleBonus;
            const baseTranslateY = tab.classList.contains('active') ? -4 : 0;
            
            tab.style.transform = `translateY(${baseTranslateY - 8}px) scale(${hoverScale})`;
        }

        function resetTab(event) {
            const tab = event.currentTarget;
            const baseScale = tab.classList.contains('active') ? 1.05 : 1.0;
            const baseTranslateY = tab.classList.contains('active') ? -4 : 0;
            
            tab.style.transform = `translateY(${baseTranslateY}px) scale(${baseScale})`;
        }

        function deleteFood(id) {
            foods = foods.filter(f => f.id !== id);
            saveData();
            renderFoodList();
        }

        function renderFoodList() {
            const container = document.getElementById('foodList');
            
            if (foods.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <p>No foods logged today. Add your first meal!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = foods.map(food => `
                <div class="food-item">
                    <div class="food-item-info">
                        <h4>${food.name}</h4>
                        <p>${food.calories} cal ‚Ä¢ P: ${food.protein}g ‚Ä¢ C: ${food.carbs}g ‚Ä¢ F: ${food.fats}g</p>
                    </div>
                    <button onclick="deleteFood(${food.id})">Delete</button>
                </div>
            `).join('');
        }

        function getTotals() {
            return foods.reduce((acc, food) => {
                acc.calories += food.calories;
                acc.protein += food.protein;
                acc.carbs += food.carbs;
                acc.fats += food.fats;
                return acc;
            }, { calories: 0, protein: 0, carbs: 0, fats: 0 });
        }

        function updateStats() {
            const totals = getTotals();
            const goals = getGoals();

            document.getElementById('totalCalories').textContent = Math.round(totals.calories);
            document.getElementById('totalProtein').textContent = Math.round(totals.protein) + 'g';
            document.getElementById('totalCarbs').textContent = Math.round(totals.carbs) + 'g';
            document.getElementById('totalFats').textContent = Math.round(totals.fats) + 'g';

            // Update progress bars
            document.getElementById('caloriesProgress').style.width = Math.min((totals.calories / goals.calories) * 100, 100) + '%';
            document.getElementById('proteinProgress').style.width = Math.min((totals.protein / goals.protein) * 100, 100) + '%';
            document.getElementById('carbsProgress').style.width = Math.min((totals.carbs / goals.carbs) * 100, 100) + '%';
            document.getElementById('fatsProgress').style.width = Math.min((totals.fats / goals.fats) * 100, 100) + '%';

            updatePieChart(totals);
            updateBarChart(totals, goals);
            updateBenchmarkComparison(totals);
        }

        function updateBenchmarkComparison(totals) {
            const bodyStatsStr = localStorage.getItem('bodyStats');
            if (!bodyStatsStr) {
                document.getElementById('benchmarkContent').innerHTML = `
                    <p style="font-size: 13px; color: #6c757d; text-align: center; padding: 20px;">
                        Add your body stats in the Goals tab to see personalized comparisons
                    </p>
                `;
                return;
            }

            const stats = JSON.parse(bodyStatsStr);
            const weight = stats.currentWeight;
            const age = stats.age;
            const gender = stats.gender;

            if (!weight || !age) {
                document.getElementById('benchmarkContent').innerHTML = `
                    <p style="font-size: 13px; color: #6c757d; text-align: center; padding: 20px;">
                        Complete your age and weight in the Goals tab
                    </p>
                `;
                return;
            }

            // Average recommendations for similar profile
            const avgProtein = Math.round(weight * 0.8); // 0.8g per lb for average person
            const avgCalories = gender === 'male' ? 2200 : 1800; // rough averages
            const avgCarbs = Math.round((avgCalories * 0.45) / 4); // 45% of calories
            const avgFats = Math.round((avgCalories * 0.30) / 9); // 30% of calories

            const comparison = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    <div>
                        <div style="font-size: 11px; color: #6c757d; margin-bottom: 4px;">YOUR INTAKE</div>
                        <div style="font-size: 16px; font-weight: 600; color: #009b3a;">${Math.round(totals.calories)} cal</div>
                        <div style="font-size: 12px; color: #495057;">P: ${Math.round(totals.protein)}g | C: ${Math.round(totals.carbs)}g | F: ${Math.round(totals.fats)}g</div>
                    </div>
                    <div>
                        <div style="font-size: 11px; color: #6c757d; margin-bottom: 4px;">AVERAGE ${gender.toUpperCase()}, ${age}Y, ${weight}LBS</div>
                        <div style="font-size: 16px; font-weight: 600; color: #6c757d;">${avgCalories} cal</div>
                        <div style="font-size: 12px; color: #495057;">P: ${avgProtein}g | C: ${avgCarbs}g | F: ${avgFats}g</div>
                    </div>
                </div>
                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #e9ecef;">
                    <div style="font-size: 12px; color: #495057; margin-bottom: 4px;">
                        <strong>Calories:</strong> 
                        ${totals.calories > avgCalories + 200 ? 
                            `<span style="color: #ffa500;">‚Üë ${Math.round(totals.calories - avgCalories)} above average</span>` :
                            totals.calories < avgCalories - 200 ?
                            `<span style="color: #009b3a;">‚Üì ${Math.round(avgCalories - totals.calories)} below average</span>` :
                            `<span style="color: #009b3a;">‚úì Within average range</span>`
                        }
                    </div>
                    <div style="font-size: 12px; color: #495057;">
                        <strong>Protein:</strong> 
                        ${totals.protein > avgProtein + 20 ? 
                            `<span style="color: #009b3a;">‚Üë Higher than average (good for muscle)</span>` :
                            totals.protein < avgProtein - 20 ?
                            `<span style="color: #ffa500;">‚Üì Lower than average</span>` :
                            `<span style="color: #009b3a;">‚úì Within average range</span>`
                        }
                    </div>
                </div>
            `;

            document.getElementById('benchmarkContent').innerHTML = comparison;
        }

        function toggleDietExamples() {
            const element = document.getElementById('dietExamples');
            element.style.display = element.style.display === 'none' ? 'block' : 'none';
        }

        function applyDietTemplate(template) {
            const templates = {
                highprotein: { calories: 2500, protein: 200, carbs: 250, fats: 78 },
                balanced: { calories: 2000, protein: 100, carbs: 250, fats: 67 },
                lowcarb: { calories: 1800, protein: 135, carbs: 90, fats: 100 },
                deficit: { calories: 1600, protein: 140, carbs: 160, fats: 44 },
                leanbulk: { calories: 2800, protein: 175, carbs: 350, fats: 78 },
                endurance: { calories: 3000, protein: 150, carbs: 450, fats: 67 }
            };

            const selected = templates[template];
            if (!selected) return;

            document.getElementById('goalCalories').value = selected.calories;
            document.getElementById('goalProtein').value = selected.protein;
            document.getElementById('goalCarbs').value = selected.carbs;
            document.getElementById('goalFats').value = selected.fats;

            saveGoals();

            const names = {
                highprotein: 'High Protein',
                balanced: 'Balanced',
                lowcarb: 'Low Carb',
                deficit: 'Weight Loss',
                leanbulk: 'Lean Bulk',
                endurance: 'Endurance'
            };

            alert(`Applied "${names[template]}" diet template!\n\nCalories: ${selected.calories}\nProtein: ${selected.protein}g\nCarbs: ${selected.carbs}g\nFats: ${selected.fats}g`);
        }

        function updateGoalProgress() {
            const totals = getTotals();
            const goals = getGoals();

            document.getElementById('caloriesGoalText').textContent = `${Math.round(totals.calories)} / ${goals.calories}`;
            document.getElementById('proteinGoalText').textContent = `${Math.round(totals.protein)}g / ${goals.protein}g`;
            document.getElementById('carbsGoalText').textContent = `${Math.round(totals.carbs)}g / ${goals.carbs}g`;
            document.getElementById('fatsGoalText').textContent = `${Math.round(totals.fats)}g / ${goals.fats}g`;

            document.getElementById('caloriesGoalProgress').style.width = Math.min((totals.calories / goals.calories) * 100, 100) + '%';
            document.getElementById('proteinGoalProgress').style.width = Math.min((totals.protein / goals.protein) * 100, 100) + '%';
            document.getElementById('carbsGoalProgress').style.width = Math.min((totals.carbs / goals.carbs) * 100, 100) + '%';
            document.getElementById('fatsGoalProgress').style.width = Math.min((totals.fats / goals.fats) * 100, 100) + '%';
        }

        function updatePieChart(totals) {
            const ctx = document.getElementById('pieChart').getContext('2d');
            
            if (pieChart) {
                pieChart.destroy();
            }

            pieChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Protein', 'Carbs', 'Fats'],
                    datasets: [{
                        data: [totals.protein, totals.carbs, totals.fats],
                        backgroundColor: ['#009b3a', '#ffd700', '#75d97e']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function updateBarChart(totals, goals) {
            const ctx = document.getElementById('barChart').getContext('2d');
            
            if (barChart) {
                barChart.destroy();
            }

            barChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Calories', 'Protein', 'Carbs', 'Fats'],
                    datasets: [
                        {
                            label: 'Current',
                            data: [totals.calories, totals.protein, totals.carbs, totals.fats],
                            backgroundColor: '#009b3a'
                        },
                        {
                            label: 'Goal',
                            data: [goals.calories, goals.protein, goals.carbs, goals.fats],
                            backgroundColor: '#e9ecef'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Settings Functions
        function toggleSettings() {
            const modal = document.getElementById('settingsModal');
            modal.style.display = modal.style.display === 'none' ? 'flex' : 'none';
        }

        function toggleDarkMode() {
            const isDark = document.getElementById('darkModeToggle').checked;
            document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
            localStorage.setItem('darkMode', isDark);
        }

        function loadSettings() {
            // Load dark mode preference
            const darkMode = localStorage.getItem('darkMode') === 'true';
            document.getElementById('darkModeToggle').checked = darkMode;
            if (darkMode) {
                document.documentElement.setAttribute('data-theme', 'dark');
            }

            // Load weight unit preference
            const weightUnit = localStorage.getItem('weightUnit') || 'lbs';
            document.getElementById('weightUnit').value = weightUnit;
        }

        function saveSettings() {
            const weightUnit = document.getElementById('weightUnit').value;
            localStorage.setItem('weightUnit', weightUnit);
        }

        function exportData() {
            const data = {
                foods: foodsByDate,
                templates: mealTemplates,
                goals: localStorage.getItem('nutritionGoals'),
                bodyStats: localStorage.getItem('bodyStats'),
                settings: {
                    darkMode: localStorage.getItem('darkMode'),
                    weightUnit: localStorage.getItem('weightUnit')
                },
                exportDate: new Date().toISOString()
            };

            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `elenia-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            alert('Data exported successfully!');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        if (data.foods) {
                            foodsByDate = data.foods;
                            localStorage.setItem('nutritionDataByDate', JSON.stringify(foodsByDate));
                        }
                        if (data.templates) {
                            mealTemplates = data.templates;
                            localStorage.setItem('mealTemplates', JSON.stringify(mealTemplates));
                        }
                        if (data.goals) {
                            localStorage.setItem('nutritionGoals', data.goals);
                        }
                        if (data.bodyStats) {
                            localStorage.setItem('bodyStats', data.bodyStats);
                        }
                        if (data.settings) {
                            if (data.settings.darkMode) localStorage.setItem('darkMode', data.settings.darkMode);
                            if (data.settings.weightUnit) localStorage.setItem('weightUnit', data.settings.weightUnit);
                        }
                        
                        alert('Data imported successfully! Reloading...');
                        location.reload();
                    } catch (error) {
                        alert('Error importing data. Please check the file format.');
                        console.error(error);
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        function clearAllData() {
            if (!confirm('Are you sure you want to delete ALL data? This cannot be undone!')) return;
            if (!confirm('Really delete everything? This is your last warning!')) return;
            
            localStorage.clear();
            alert('All data cleared. Reloading...');
            location.reload();
        }

        // Meal Template Functions
        function loadMealTemplates() {
            const saved = localStorage.getItem('mealTemplates');
            if (saved) {
                mealTemplates = JSON.parse(saved);
                renderMealTemplates();
            }
        }

        function showCreateTemplate() {
            document.getElementById('templateBuilder').style.display = 'block';
            currentTemplateBuilder = [];
            document.getElementById('templateName').value = '';
            document.getElementById('templateFoodSearch').value = '';
            document.getElementById('templateFoodsList').innerHTML = '<p style="font-size: 12px; color: #6c757d; text-align: center;">No foods added yet</p>';
        }

        function cancelTemplate() {
            document.getElementById('templateBuilder').style.display = 'none';
            currentTemplateBuilder = [];
        }

        function searchFoodForTemplate() {
            const query = document.getElementById('templateFoodSearch').value.toLowerCase();
            const resultsDiv = document.getElementById('templateSearchResults');
            
            if (query.length < 2) {
                resultsDiv.style.display = 'none';
                return;
            }

            const matches = foodDatabase.filter(food => 
                food.name.toLowerCase().includes(query)
            ).slice(0, 8);

            if (matches.length === 0) {
                resultsDiv.style.display = 'none';
                return;
            }

            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = matches.map(food => `
                <div style="padding: 10px; border-bottom: 1px solid #e9ecef; cursor: pointer;" 
                     onclick="selectTemplateFood('${food.name.replace(/'/g, "\\'")}')"
                     onmouseover="this.style.background='#f8f9fa'" 
                     onmouseout="this.style.background='white'">
                    <div style="font-weight: 600; font-size: 13px;">${food.name}</div>
                    <div style="font-size: 11px; color: #6c757d;">${food.calories} cal ‚Ä¢ P:${food.protein}g C:${food.carbs}g F:${food.fats}g</div>
                </div>
            `).join('');
        }

        function selectTemplateFood(foodName) {
            const food = foodDatabase.find(f => f.name === foodName);
            if (!food) return;

            const portion = prompt(`How many grams of ${food.name}?`, '100');
            if (!portion || portion <= 0) return;

            const multiplier = parseFloat(portion) / 100;
            
            currentTemplateBuilder.push({
                name: `${food.name} (${portion}g)`,
                calories: food.calories * multiplier,
                protein: food.protein * multiplier,
                carbs: food.carbs * multiplier,
                fats: food.fats * multiplier,
                baseName: food.name,
                portion: parseFloat(portion)
            });

            document.getElementById('templateSearchResults').style.display = 'none';
            document.getElementById('templateFoodSearch').value = '';
            renderTemplateBuilder();
        }

        function renderTemplateBuilder() {
            const container = document.getElementById('templateFoodsList');
            
            if (currentTemplateBuilder.length === 0) {
                container.innerHTML = '<p style="font-size: 12px; color: #6c757d; text-align: center;">No foods added yet</p>';
                return;
            }

            const totals = currentTemplateBuilder.reduce((acc, item) => {
                acc.calories += item.calories;
                acc.protein += item.protein;
                acc.carbs += item.carbs;
                acc.fats += item.fats;
                return acc;
            }, {calories: 0, protein: 0, carbs: 0, fats: 0});

            container.innerHTML = `
                ${currentTemplateBuilder.map((item, idx) => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; border-bottom: 1px solid #e9ecef;">
                        <div>
                            <div style="font-size: 13px; font-weight: 600;">${item.name}</div>
                            <div style="font-size: 11px; color: #6c757d;">${Math.round(item.calories)} cal</div>
                        </div>
                        <button onclick="removeFromTemplateBuilder(${idx})" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 11px; cursor: pointer;">√ó</button>
                    </div>
                `).join('')}
                <div style="background: linear-gradient(135deg, #009b3a 0%, #ffd700 100%); color: white; padding: 10px; margin-top: 8px; border-radius: 6px; text-align: center;">
                    <div style="font-size: 12px; opacity: 0.9;">Total</div>
                    <div style="font-size: 14px; font-weight: 600;">${Math.round(totals.calories)} cal ‚Ä¢ P:${Math.round(totals.protein)}g C:${Math.round(totals.carbs)}g F:${Math.round(totals.fats)}g</div>
                </div>
            `;
        }

        function removeFromTemplateBuilder(idx) {
            currentTemplateBuilder.splice(idx, 1);
            renderTemplateBuilder();
        }

        function saveTemplate() {
            const name = document.getElementById('templateName').value.trim();
            const mealType = document.getElementById('templateMealType').value;

            if (!name) {
                alert('Please enter a template name');
                return;
            }

            if (currentTemplateBuilder.length === 0) {
                alert('Please add at least one food to the template');
                return;
            }

            const template = {
                id: Date.now(),
                name: name,
                mealType: mealType,
                foods: currentTemplateBuilder,
                created: new Date().toISOString()
            };

            mealTemplates.push(template);
            localStorage.setItem('mealTemplates', JSON.stringify(mealTemplates));

            renderMealTemplates();
            cancelTemplate();
            alert(`Template "${name}" saved!`);
        }

        function renderMealTemplates() {
            const container = document.getElementById('mealTemplatesList');
            
            if (mealTemplates.length === 0) {
                container.innerHTML = '<p style="font-size: 13px; color: #6c757d; text-align: center; padding: 20px;">No meal templates yet. Create one to get started!</p>';
                document.getElementById('scheduleInterface').innerHTML = '<p style="font-size: 13px; color: #6c757d; text-align: center; padding: 20px;">Create a meal template first, then schedule it for specific days</p>';
                return;
            }

            container.innerHTML = mealTemplates.map(template => {
                const totals = template.foods.reduce((acc, item) => {
                    acc.calories += item.calories;
                    acc.protein += item.protein;
                    return acc;
                }, {calories: 0, protein: 0});

                return `
                    <div style="background: white; padding: 12px; border-radius: 8px; margin-bottom: 8px; border: 2px solid #e9ecef;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <div>
                                <h4 style="font-size: 14px; margin-bottom: 4px;">${template.name}</h4>
                                <div style="font-size: 11px; color: #6c757d;">${template.mealType} ‚Ä¢ ${template.foods.length} items</div>
                            </div>
                            <button onclick="deleteTemplate(${template.id})" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 11px; cursor: pointer;">Delete</button>
                        </div>
                        <div style="font-size: 12px; color: #495057; margin-bottom: 8px;">
                            ${Math.round(totals.calories)} cal ‚Ä¢ ${Math.round(totals.protein)}g protein
                        </div>
                        <div style="display: flex; gap: 6px;">
                            <button onclick="addTemplateToToday(${template.id})" style="flex: 1; background: #009b3a; color: white; border: none; padding: 6px; border-radius: 6px; font-size: 11px; cursor: pointer; font-weight: 600;">Add to Today</button>
                            <button onclick="scheduleTemplate(${template.id})" style="flex: 1; background: #ffd700; color: #333; border: none; padding: 6px; border-radius: 6px; font-size: 11px; cursor: pointer; font-weight: 600;">Schedule</button>
                        </div>
                    </div>
                `;
            }).join('');

            renderScheduleInterface();
        }

        function deleteTemplate(id) {
            if (!confirm('Delete this template?')) return;
            mealTemplates = mealTemplates.filter(t => t.id !== id);
            localStorage.setItem('mealTemplates', JSON.stringify(mealTemplates));
            renderMealTemplates();
        }

        function addTemplateToToday(id) {
            const template = mealTemplates.find(t => t.id === id);
            if (!template) return;

            const todayKey = getTodayKey();
            
            template.foods.forEach(foodItem => {
                foods.push({
                    ...foodItem,
                    id: Date.now() + Math.random()
                });
            });

            saveData();
            renderFoodList();
            alert(`"${template.name}" added to today!`);
        }

        function scheduleTemplate(id) {
            const template = mealTemplates.find(t => t.id === id);
            if (!template) return;

            const dateInput = prompt('Enter date to schedule (YYYY-MM-DD):', getTodayKey());
            if (!dateInput) return;

            // Validate date format
            if (!/^\d{4}-\d{2}-\d{2}$/.test(dateInput)) {
                alert('Invalid date format. Use YYYY-MM-DD');
                return;
            }

            if (!foodsByDate[dateInput]) {
                foodsByDate[dateInput] = [];
            }

            template.foods.forEach(foodItem => {
                foodsByDate[dateInput].push({
                    ...foodItem,
                    id: Date.now() + Math.random()
                });
            });

            localStorage.setItem('nutritionDataByDate', JSON.stringify(foodsByDate));
            alert(`"${template.name}" scheduled for ${dateInput}!`);
        }

        function renderScheduleInterface() {
            const container = document.getElementById('scheduleInterface');
            container.innerHTML = `
                <p style="font-size: 13px; color: #495057; margin-bottom: 12px;">Click "Schedule" on any template above to add it to a specific date</p>
                <div style="background: white; padding: 12px; border-radius: 8px;">
                    <h4 style="font-size: 13px; margin-bottom: 8px;">Quick Actions:</h4>
                    <p style="font-size: 12px; color: #6c757d; margin-bottom: 8px;">‚Ä¢ <strong>Add to Today:</strong> Immediately adds template to today's log</p>
                    <p style="font-size: 12px; color: #6c757d;">‚Ä¢ <strong>Schedule:</strong> Choose a future date to pre-plan meals</p>
                </div>
            `;
        }

        // Photo Analysis Functions
        async function analyzeFoodPhoto(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Show preview
            const reader = new FileReader();
            reader.onload = async function(e) {
                document.getElementById('previewImage').src = e.target.result;
                document.getElementById('photoPreview').style.display = 'block';
                document.getElementById('analysisLoading').style.display = 'block';
                document.getElementById('analysisResults').style.display = 'none';
                
                // Convert to base64
                const base64Image = e.target.result.split(',')[1];
                
                try {
                    // Call Claude API to analyze the food
                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'anthropic-version': '2023-06-01'
                        },
                        body: JSON.stringify({
                            model: 'claude-sonnet-4-20250514',
                            max_tokens: 1000,
                            messages: [{
                                role: 'user',
                                content: [
                                    {
                                        type: 'image',
                                        source: {
                                            type: 'base64',
                                            media_type: file.type,
                                            data: base64Image
                                        }
                                    },
                                    {
                                        type: 'text',
                                        text: `Analyze this food photo and identify all visible food items with estimated portion sizes in grams. 
                                        
For each food item, provide:
1. Food name (be specific, e.g., "grilled chicken breast" not just "chicken")
2. Estimated portion size in grams
3. Brief confidence note if uncertain

Respond ONLY with valid JSON in this exact format (no markdown, no backticks):
{
  "foods": [
    {"name": "food name", "grams": 150, "confidence": "high"},
    {"name": "food name", "grams": 100, "confidence": "medium"}
  ]
}

Be realistic with portions. A typical chicken breast is 150-200g, rice serving is 150-200g, etc.`
                                    }
                                ]
                            }]
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.content && data.content[0] && data.content[0].text) {
                        const resultText = data.content[0].text.trim();
                        // Remove markdown code fences if present
                        const cleanedText = resultText.replace(/```json\n?|\n?```/g, '').trim();
                        const result = JSON.parse(cleanedText);
                        
                        displayDetectedFoods(result.foods);
                    } else {
                        throw new Error('Invalid response from API');
                    }
                    
                } catch (error) {
                    console.error('Error analyzing food:', error);
                    document.getElementById('analysisLoading').style.display = 'none';
                    alert('Error analyzing photo. Please try again or add foods manually.');
                }
            };
            reader.readAsDataURL(file);
        }
        
        function displayDetectedFoods(foods) {
            document.getElementById('analysisLoading').style.display = 'none';
            document.getElementById('analysisResults').style.display = 'block';
            
            detectedFoodsFromPhoto = foods;
            
            const container = document.getElementById('detectedFoods');
            container.innerHTML = foods.map((food, index) => {
                // Try to find matching food in database
                const dbMatch = findBestMatch(food.name);
                const matchInfo = dbMatch ? 
                    `<div style="font-size: 11px; color: #009b3a; margin-top: 2px;">‚úì Matched: ${dbMatch.name}</div>` :
                    `<div style="font-size: 11px; color: #ffa500; margin-top: 2px;">‚ö† Not in database - will estimate</div>`;
                
                return `
                    <div style="background: white; padding: 10px; border-radius: 6px; margin-bottom: 8px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong style="font-size: 14px;">${food.name}</strong>
                                <div style="font-size: 12px; color: #6c757d;">~${food.grams}g (${food.confidence} confidence)</div>
                                ${matchInfo}
                            </div>
                            <button onclick="removeDetectedFood(${index})" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer;">‚úï</button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function findBestMatch(foodName) {
            const searchTerms = foodName.toLowerCase().split(' ');
            
            // Try exact match first
            let match = foodDatabase.find(f => 
                f.name.toLowerCase() === foodName.toLowerCase()
            );
            
            if (match) return match;
            
            // Try partial matches
            match = foodDatabase.find(f => {
                const dbName = f.name.toLowerCase();
                return searchTerms.every(term => dbName.includes(term));
            });
            
            if (match) return match;
            
            // Try any keyword match
            match = foodDatabase.find(f => {
                const dbName = f.name.toLowerCase();
                return searchTerms.some(term => dbName.includes(term) || term.includes(dbName.split(' ')[0]));
            });
            
            return match;
        }
        
        function removeDetectedFood(index) {
            detectedFoodsFromPhoto.splice(index, 1);
            displayDetectedFoods(detectedFoodsFromPhoto);
        }
        
        function addDetectedFoods() {
            if (detectedFoodsFromPhoto.length === 0) return;
            
            detectedFoodsFromPhoto.forEach(detectedFood => {
                const dbMatch = findBestMatch(detectedFood.name);
                
                if (dbMatch) {
                    // Use database nutrition, scaled to portion
                    const multiplier = detectedFood.grams / 100;
                    currentMeal.push({
                        name: `${dbMatch.name} (${detectedFood.grams}g)`,
                        calories: dbMatch.calories * multiplier,
                        protein: dbMatch.protein * multiplier,
                        carbs: dbMatch.carbs * multiplier,
                        fats: dbMatch.fats * multiplier,
                        id: Date.now() + Math.random()
                    });
                } else {
                    // Estimate nutrition for unknown food
                    // Use conservative estimates: ~150 cal/100g, balanced macros
                    const multiplier = detectedFood.grams / 100;
                    currentMeal.push({
                        name: `${detectedFood.name} (${detectedFood.grams}g, estimated)`,
                        calories: 150 * multiplier,
                        protein: 8 * multiplier,
                        carbs: 20 * multiplier,
                        fats: 5 * multiplier,
                        id: Date.now() + Math.random()
                    });
                }
            });
            
            updateMealBuilder();
            
            // Clear photo analysis
            document.getElementById('photoPreview').style.display = 'none';
            document.getElementById('foodPhoto').value = '';
            detectedFoodsFromPhoto = [];
        }

        // Meal Builder Functions
        function addToMeal() {
            if (!selectedFood) return;
            
            const portion = parseFloat(document.getElementById('portionSize').value) || 0;
            if (portion <= 0) {
                alert('Please enter a valid portion size');
                return;
            }
            
            const multiplier = portion / 100;
            
            const foodItem = {
                name: `${selectedFood.name} (${portion}g)`,
                calories: selectedFood.calories * multiplier,
                protein: selectedFood.protein * multiplier,
                carbs: selectedFood.carbs * multiplier,
                fats: selectedFood.fats * multiplier,
                id: Date.now()
            };
            
            currentMeal.push(foodItem);
            updateMealBuilder();
            cancelSelection();
        }

        function updateMealBuilder() {
            if (currentMeal.length === 0) {
                document.getElementById('mealBuilder').style.display = 'none';
                return;
            }

            document.getElementById('mealBuilder').style.display = 'block';
            
            const mealName = document.getElementById('mealName').value;
            document.getElementById('mealBuilderName').textContent = mealName ? `(${mealName})` : '';
            
            const mealItems = document.getElementById('mealItems');
            mealItems.innerHTML = currentMeal.map((item, index) => `
                <div style="background: white; padding: 8px; border-radius: 6px; margin-bottom: 6px; display: flex; justify-content: space-between; align-items: center; font-size: 13px;">
                    <span>${item.name}</span>
                    <button onclick="removeFromMeal(${index})" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 11px; cursor: pointer;">√ó</button>
                </div>
            `).join('');
            
            const totals = currentMeal.reduce((acc, item) => {
                acc.calories += item.calories;
                acc.protein += item.protein;
                acc.carbs += item.carbs;
                acc.fats += item.fats;
                return acc;
            }, { calories: 0, protein: 0, carbs: 0, fats: 0 });
            
            document.getElementById('mealTotal').textContent = 
                `${Math.round(totals.calories)} cal ‚Ä¢ P: ${Math.round(totals.protein)}g ‚Ä¢ C: ${Math.round(totals.carbs)}g ‚Ä¢ F: ${Math.round(totals.fats)}g`;
        }

        function removeFromMeal(index) {
            currentMeal.splice(index, 1);
            updateMealBuilder();
        }

        function submitMeal() {
            if (currentMeal.length === 0) return;
            
            const mealName = document.getElementById('mealName').value || 'Meal';
            
            const mealTotals = currentMeal.reduce((acc, item) => {
                acc.calories += item.calories;
                acc.protein += item.protein;
                acc.carbs += item.carbs;
                acc.fats += item.fats;
                return acc;
            }, { calories: 0, protein: 0, carbs: 0, fats: 0 });
            
            const meal = {
                name: `${mealName} (${currentMeal.length} items)`,
                calories: mealTotals.calories,
                protein: mealTotals.protein,
                carbs: mealTotals.carbs,
                fats: mealTotals.fats,
                id: Date.now(),
                items: currentMeal.map(i => i.name).join(', ')
            };
            
            foods.push(meal);
            saveData();
            renderFoodList();
            clearMeal();
        }

        function clearMeal() {
            currentMeal = [];
            document.getElementById('mealName').value = '';
            updateMealBuilder();
        }

        // Calendar Functions
        function setCalendarView(view) {
            calendarView = view;
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('view' + view.charAt(0).toUpperCase() + view.slice(1)).classList.add('active');
            renderCalendar();
        }

        function navigateTime(delta) {
            if (calendarView === 'month') {
                viewingMonth.setMonth(viewingMonth.getMonth() + delta);
            } else if (calendarView === 'week') {
                viewingMonth.setDate(viewingMonth.getDate() + (delta * 7));
            } else if (calendarView === 'day') {
                viewingMonth.setDate(viewingMonth.getDate() + delta);
            }
            renderCalendar();
        }

        function goToToday() {
            viewingMonth = new Date();
            renderCalendar();
        }

        function renderCalendar() {
            if (calendarView === 'month') {
                renderMonthView();
            } else if (calendarView === 'week') {
                renderWeekView();
            } else if (calendarView === 'day') {
                renderDayView();
            }
        }

        function renderMonthView() {
            const year = viewingMonth.getFullYear();
            const month = viewingMonth.getMonth();
            
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                              'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('calendarMonth').textContent = `${monthNames[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrevMonth = new Date(year, month, 0).getDate();
            
            const grid = document.getElementById('calendarGrid');
            grid.style.display = 'grid';
            grid.style.gridTemplateColumns = 'repeat(7, 1fr)';
            grid.innerHTML = '';
            
            // Day headers
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            days.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-header';
                header.textContent = day;
                grid.appendChild(header);
            });
            
            // Previous month days
            for (let i = firstDay - 1; i >= 0; i--) {
                const day = daysInPrevMonth - i;
                const cell = createCalendarDay(day, month - 1, year, true);
                grid.appendChild(cell);
            }
            
            // Current month days
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const isToday = date.toDateString() === today.toDateString();
                const cell = createCalendarDay(day, month, year, false, isToday);
                grid.appendChild(cell);
            }
            
            // Next month days
            const remainingCells = 42 - (firstDay + daysInMonth);
            for (let day = 1; day <= remainingCells; day++) {
                const cell = createCalendarDay(day, month + 1, year, true);
                grid.appendChild(cell);
            }
        }

        function renderWeekView() {
            const grid = document.getElementById('calendarGrid');
            grid.style.display = 'grid';
            grid.style.gridTemplateColumns = 'repeat(7, 1fr)';
            grid.innerHTML = '';
            
            // Get start of week (Sunday)
            const startOfWeek = new Date(viewingMonth);
            startOfWeek.setDate(startOfWeek.getDate() - startOfWeek.getDay());
            
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(endOfWeek.getDate() + 6);
            
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                              'July', 'August', 'September', 'October', 'November', 'December'];
            
            const startMonth = monthNames[startOfWeek.getMonth()];
            const endMonth = monthNames[endOfWeek.getMonth()];
            
            if (startMonth === endMonth) {
                document.getElementById('calendarMonth').textContent = 
                    `${startMonth} ${startOfWeek.getDate()}-${endOfWeek.getDate()}, ${startOfWeek.getFullYear()}`;
            } else {
                document.getElementById('calendarMonth').textContent = 
                    `${startMonth} ${startOfWeek.getDate()} - ${endMonth} ${endOfWeek.getDate()}, ${startOfWeek.getFullYear()}`;
            }
            
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const today = new Date();
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(startOfWeek);
                date.setDate(date.getDate() + i);
                
                const col = document.createElement('div');
                col.className = 'week-day-column';
                
                const isToday = date.toDateString() === today.toDateString();
                if (isToday) col.classList.add('today');
                
                const dateKey = getDateKey(date);
                const dayFoods = foodsByDate[dateKey] || [];
                const totalCals = dayFoods.reduce((sum, f) => sum + f.calories, 0);
                
                col.innerHTML = `
                    <div class="week-day-header">${days[i]}</div>
                    <div class="week-day-date">${date.getDate()}</div>
                    <div style="font-size: 11px; color: #6c757d; text-align: center; margin-top: 4px;">
                        ${dayFoods.length > 0 ? `${Math.round(totalCals)} cal` : ''}
                    </div>
                    ${dayFoods.length > 0 ? `<div style="font-size: 10px; color: #009b3a; text-align: center; margin-top: 4px;">${dayFoods.length} meals</div>` : ''}
                `;
                
                col.onclick = () => viewDate(date);
                col.style.cursor = 'pointer';
                
                grid.appendChild(col);
            }
        }

        function renderDayView() {
            const grid = document.getElementById('calendarGrid');
            grid.style.display = 'block';
            grid.innerHTML = '';
            
            const date = new Date(viewingMonth);
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                              'July', 'August', 'September', 'October', 'November', 'December'];
            const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            
            document.getElementById('calendarMonth').textContent = 
                `${dayNames[date.getDay()]}, ${monthNames[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`;
            
            const dateKey = getDateKey(date);
            const dayFoods = foodsByDate[dateKey] || [];
            
            const container = document.createElement('div');
            container.className = 'day-view-container';
            
            if (dayFoods.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #6c757d;">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 48px; height: 48px; margin: 0 auto 16px; opacity: 0.5;">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <p>No meals logged for this day</p>
                    </div>
                `;
            } else {
                const totals = dayFoods.reduce((acc, f) => {
                    acc.calories += f.calories;
                    acc.protein += f.protein;
                    acc.carbs += f.carbs;
                    acc.fats += f.fats;
                    return acc;
                }, { calories: 0, protein: 0, carbs: 0, fats: 0 });
                
                container.innerHTML = `
                    <div style="background: linear-gradient(135deg, #009b3a 0%, #ffd700 100%); color: white; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                        <h3 style="font-size: 16px; margin-bottom: 8px;">Daily Summary</h3>
                        <p style="font-size: 14px;">${Math.round(totals.calories)} cal ‚Ä¢ P: ${Math.round(totals.protein)}g ‚Ä¢ C: ${Math.round(totals.carbs)}g ‚Ä¢ F: ${Math.round(totals.fats)}g</p>
                    </div>
                    ${dayFoods.map(food => `
                        <div class="meal-item" style="margin-bottom: 12px;">
                            <h4>${food.name}</h4>
                            <p>${Math.round(food.calories)} cal ‚Ä¢ P: ${Math.round(food.protein)}g ‚Ä¢ C: ${Math.round(food.carbs)}g ‚Ä¢ F: ${Math.round(food.fats)}g</p>
                            ${food.items ? `<p style="font-size: 11px; margin-top: 4px;">${food.items}</p>` : ''}
                        </div>
                    `).join('')}
                `;
            }
            
            grid.appendChild(container);
        }

        function createCalendarDay(day, month, year, isOtherMonth, isToday = false) {
            const cell = document.createElement('div');
            cell.className = 'calendar-day';
            if (isOtherMonth) cell.classList.add('other-month');
            if (isToday) cell.classList.add('today');
            
            const date = new Date(year, month, day);
            const dateKey = getDateKey(date);
            const dayFoods = foodsByDate[dateKey] || [];
            
            if (dayFoods.length > 0) {
                cell.classList.add('has-data');
                const totalCals = dayFoods.reduce((sum, f) => sum + f.calories, 0);
                cell.innerHTML = `
                    <div class="calendar-day-number">${day}</div>
                    <div class="calendar-day-calories">${Math.round(totalCals)} cal</div>
                `;
            } else {
                cell.innerHTML = `<div class="calendar-day-number">${day}</div>`;
            }
            
            if (!isOtherMonth) {
                cell.onclick = () => viewDate(date);
            }
            
            return cell;
        }

        function viewDate(date) {
            selectedDate = date;
            const dateKey = getDateKey(date);
            const dateFoods = foodsByDate[dateKey] || [];
            
            const dateStr = date.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            document.getElementById('selectedDateTitle').textContent = dateStr;
            
            if (dateFoods.length === 0) {
                document.getElementById('selectedDateSummary').textContent = 'No meals logged for this day';
                document.getElementById('selectedDateFoods').innerHTML = '<p style="text-align: center; color: #6c757d; padding: 20px;">No data</p>';
            } else {
                const totals = dateFoods.reduce((acc, f) => {
                    acc.calories += f.calories;
                    acc.protein += f.protein;
                    acc.carbs += f.carbs;
                    acc.fats += f.fats;
                    return acc;
                }, { calories: 0, protein: 0, carbs: 0, fats: 0 });
                
                document.getElementById('selectedDateSummary').textContent = 
                    `${Math.round(totals.calories)} cal ‚Ä¢ P: ${Math.round(totals.protein)}g ‚Ä¢ C: ${Math.round(totals.carbs)}g ‚Ä¢ F: ${Math.round(totals.fats)}g`;
                
                document.getElementById('selectedDateFoods').innerHTML = dateFoods.map(food => `
                    <div class="meal-item">
                        <h4>${food.name}</h4>
                        <p>${Math.round(food.calories)} cal ‚Ä¢ P: ${Math.round(food.protein)}g ‚Ä¢ C: ${Math.round(food.carbs)}g ‚Ä¢ F: ${Math.round(food.fats)}g</p>
                        ${food.items ? `<p style="font-size: 11px; margin-top: 4px;">${food.items}</p>` : ''}
                    </div>
                `).join('');
            }
            
            document.getElementById('selectedDateView').style.display = 'block';
            document.getElementById('calendarGrid').parentElement.style.display = 'none';
        }

        function closeSelectedDate() {
            selectedDate = null;
            document.getElementById('selectedDateView').style.display = 'none';
            document.getElementById('calendarGrid').parentElement.style.display = 'block';
        }

        // Initialize
        console.log('Initializing app...');
        loadSettings();
        loadData();
        loadMealTemplates();
        console.log('Data loaded. Foods for today:', foods.length);
        renderFoodList();
        console.log('=== Elenia Ready ===');
    </script>
    <script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>
</body>
</html>
